/**
 * éšå±¤çš„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  - TDD Red Phase
 * ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: HierarchicalPluginRouter.test.ts
 */

// Vitest APIã‚’ä½¿ç”¨ - Jestã§ã¯ãªãå®Œå…¨ã«Vitestçµ±ä¸€
import { describe, test, expect, beforeEach, afterEach } from 'vitest';
import React from 'react';

// æœªå®Ÿè£…ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹åŸå› ï¼‰
import {
  HierarchicalPluginRouter,
  parseHierarchicalUrl,
  PluginRegistry,
  loadPluginComponent,
  type PluginRouteParams,
  type PluginDefinition,
} from './HierarchicalPluginRouter';

describe('éšå±¤çš„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ ', () => {
  beforeEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå‰æº–å‚™ã€‘: å„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚’åˆæœŸåŒ–ã—ã€ä¸€è²«ã—ãŸãƒ†ã‚¹ãƒˆæ¡ä»¶ã‚’ä¿è¨¼
    // ã€ç’°å¢ƒåˆæœŸåŒ–ã€‘: å‰ã®ãƒ†ã‚¹ãƒˆã®å½±éŸ¿ã‚’å—ã‘ãªã„ã‚ˆã†ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™»éŒ²çŠ¶æ…‹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã«ãƒªã‚»ãƒƒãƒˆ
    PluginRegistry.clear();
  });

  afterEach(() => {
    // ã€ãƒ†ã‚¹ãƒˆå¾Œå‡¦ç†ã€‘: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ã‚’å‰Šé™¤
    // ã€çŠ¶æ…‹å¾©å…ƒã€‘: æ¬¡ã®ãƒ†ã‚¹ãƒˆã«å½±éŸ¿ã—ãªã„ã‚ˆã†ã€ã‚·ã‚¹ãƒ†ãƒ ã‚’å…ƒã®çŠ¶æ…‹ã«æˆ»ã™
    PluginRegistry.clear();
  });

  describe('URLè§£ææ©Ÿèƒ½', () => {
    test('éšå±¤çš„URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«è§£æã™ã‚‹', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: React Routerã®éšå±¤çš„URLãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ­£ã—ãè§£æã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: è¤‡é›‘ãªéšå±¤URLã‹ã‚‰å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ­£ç¢ºã«æŠ½å‡ºã•ã‚Œã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å…¨ã¦ã®URLè¦ç´ ãŒé©åˆ‡ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«å®Œå…¨æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹å…¸å‹çš„ãªéšå±¤URL
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: 5ã¤ã®éšå±¤è¦ç´ ã‚’æŒã¤å®Œå…¨ãªURLãƒ‘ã‚¹
      const testUrl = '/t/tree-123/node-456/node-789/basemap/edit';

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: URLè§£æé–¢æ•°ã«ã‚ˆã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡ºå‡¦ç†
      // ã€å‡¦ç†å†…å®¹ã€‘: React Routerã®URLè§£æãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ãéšå±¤çš„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŠ½å‡º
      const params = parseHierarchicalUrl(testUrl);

      // ã€çµæœæ¤œè¨¼ã€‘: è§£æã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœŸå¾…å€¤ã¨å®Œå…¨ã«ä¸€è‡´ã™ã‚‹ã‹ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: URLæ§‹é€ ã«åŸºã¥ãå„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ­£ç¢ºãªæŠ½å‡ºã‚’æ¤œè¨¼
      expect(params.treeId).toBe('tree-123'); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ„ãƒªãƒ¼IDãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.pageNodeId).toBe('node-456'); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒšãƒ¼ã‚¸ãƒãƒ¼ãƒ‰IDãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.targetNodeId).toBe('node-789'); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰IDãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.nodeType).toBe('basemap'); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—ãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.action).toBe('edit'); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒæ­£ã—ãæŠ½å‡ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });

    test('æœ€å°URLãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®è§£æå‡¦ç†', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã®URLãŒæ­£ã—ãå‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: treeIdã®ã¿ã®æœ€å°æ§‹æˆURLã§ã®è§£æå‹•ä½œã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯è¨­å®šã•ã‚Œã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯undefinedã«ãªã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: æœ€å°æ§‹æˆã®URLï¼ˆtreeIdã®ã¿ï¼‰ã‚’ä½¿ç”¨
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå…¨ã¦çœç•¥ã•ã‚ŒãŸURL
      const minimalUrl = '/t/tree-123';

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: æœ€å°URLã§ã®è§£æå‡¦ç†ã‚’å®Ÿè¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åŒºåˆ¥å‡¦ç†
      const params = parseHierarchicalUrl(minimalUrl);

      // ã€çµæœæ¤œè¨¼ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯è¨­å®šã•ã‚Œã€ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯æœªå®šç¾©ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: æœ€å°æ§‹æˆã§ã‚‚ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’æ¤œè¨¼
      expect(params.treeId).toBe('tree-123'); // ã€ç¢ºèªå†…å®¹ã€‘: å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿treeIdãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.pageNodeId).toBeUndefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœªå®šç¾©ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.targetNodeId).toBeUndefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœªå®šç¾©ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.nodeType).toBeUndefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœªå®šç¾©ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(params.action).toBeUndefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæœªå®šç¾©ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });

    test('ç„¡åŠ¹ãªURLãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ä¸æ­£ãªURLå½¢å¼ãŒé©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦å‡¦ç†ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ç©ºæ–‡å­—åˆ—ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€URLã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ‘ãƒ¼ã‚¹å‡¦ç†ãŒã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ã‹ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’è¿”ã™
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ç©ºã®treeIDã‚’å«ã‚€ä¸æ­£ãªURL
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‘ãƒ¼ã‚¹å‡¦ç†ãŒã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹ã¹ãçŠ¶æ…‹
      const invalidUrl = '/t//node-456';

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ä¸æ­£URLã§ã®è§£æå‡¦ç†å®Ÿè¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯ã®å‹•ä½œç¢ºèª
      expect(() => parseHierarchicalUrl(invalidUrl)).toThrow(); // ã€ç¢ºèªå†…å®¹ã€‘: ç„¡åŠ¹URLã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªæ©Ÿèƒ½', () => {
    test('ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®šç¾©ã®æ­£å¸¸ç™»éŒ²', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«æ­£ã—ãç™»éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®šç¾©ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç™»éŒ²ã¨å–å¾—ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ç™»éŒ²ã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ­£ç¢ºã«å–å¾—ã§ãã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸ã«å®Œå…¨æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: basemapãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ¨™æº–çš„ãªå®šç¾©ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãŒç©ºã®çŠ¶æ…‹
      const basemapPlugin: PluginDefinition = {
        nodeType: 'basemap',
        actions: {
          view: {
            component: React.lazy(() =>
              import('@hierarchidb/20-plugin-basemap').then((m) => ({ default: m.BaseMapView }))
            ),
            permissions: ['basemap:view'],
          },
          edit: {
            component: React.lazy(() =>
              import('@hierarchidb/20-plugin-basemap').then((m) => ({ default: m.BaseMapEditor }))
            ),
            permissions: ['basemap:view', 'basemap:edit'],
          },
        },
      };

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ²å‡¦ç†
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®šç¾©ã®æ¤œè¨¼ã¨å†…éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®ä¿å­˜
      PluginRegistry.register(basemapPlugin);

      // ã€çµæœæ¤œè¨¼ã€‘: ç™»éŒ²ã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ­£ç¢ºã«å–å¾—ã§ãã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æƒ…å ±ã®å®Œå…¨æ€§ã¨æ•´åˆæ€§ã‚’æ¤œè¨¼
      const retrievedPlugin = PluginRegistry.get('basemap');
      expect(retrievedPlugin).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(retrievedPlugin?.nodeType).toBe('basemap'); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ãŒæ­£ã—ãä¿å­˜ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(retrievedPlugin?.actions.view).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: viewã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(retrievedPlugin?.actions.edit).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: editã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒç™»éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });

    test('å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å–å¾—ã‚¨ãƒ©ãƒ¼', () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æœªç™»éŒ²ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒé©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—ã§ã®å–å¾—å‡¦ç†ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: undefinedãŒè¿”ã•ã‚Œã‚‹ã‹ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—å
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ä½•ã‚‚ç™»éŒ²ã•ã‚Œã¦ã„ãªã„çŠ¶æ…‹
      const nonExistentPluginType = 'nonexistent';

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: æœªç™»éŒ²ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å–å¾—è©¦è¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰ã®æ¤œç´¢å‡¦ç†
      const result = PluginRegistry.get(nonExistentPluginType);

      // ã€çµæœæ¤œè¨¼ã€‘: æœªç™»éŒ²ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¯¾ã—ã¦é©åˆ‡ãªçµæœãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã®é©åˆ‡ãªå‡¦ç†ã‚’æ¤œè¨¼
      expect(result).toBeUndefined(); // ã€ç¢ºèªå†…å®¹ã€‘: å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¯¾ã—ã¦undefinedãŒè¿”ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('å‹•çš„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½', () => {
    test('ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆæˆåŠŸ', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: Code Splittingã«ã‚ˆã‚‹å‹•çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ãƒ¼ãƒ‰ãŒæ­£å¸¸å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«åŸºã¥ãã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: React.lazyã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£å¸¸ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«å®Œå…¨æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: basemap editã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®ãƒ†ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒäº‹å‰ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹
      const pluginParams = {
        nodeType: 'basemap',
        action: 'edit',
      };

      // ã¾ãšãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç™»éŒ²
      const basemapPlugin: PluginDefinition = {
        nodeType: 'basemap',
        actions: {
          edit: {
            component: React.lazy(() =>
              Promise.resolve({
                default: () =>
                  React.createElement(
                    'div',
                    { 'data-testid': 'basemap-edit' },
                    'Basemap Edit Component'
                  ),
              })
            ),
            permissions: ['basemap:edit'],
          },
        },
      };
      PluginRegistry.register(basemapPlugin);

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å‹•çš„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ãƒ¼ãƒ‰å‡¦ç†ã®å®Ÿè¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ­£å¸¸ãªå–å¾—
      const component = await loadPluginComponent(pluginParams.nodeType, pluginParams.action);

      // ã€çµæœæ¤œè¨¼ã€‘: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£å¸¸ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: å‹•çš„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®æˆåŠŸã‚’æ¤œè¨¼
      expect(component).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: å‹•çš„ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ­£ã—ãå–å¾—ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });

    test('å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã®404ã‚¨ãƒ©ãƒ¼', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: æœªç™»éŒ²ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒé©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å­˜åœ¨ã—ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ­ãƒ¼ãƒ‰è©¦è¡Œã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: 404ã‚¨ãƒ©ãƒ¼ç›¸å½“ã®çŠ¶æ…‹ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å­˜åœ¨ã—ãªã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«æœªç™»éŒ²ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—ã‚’ä½¿ç”¨
      const invalidParams = {
        nodeType: 'nonexistent',
        action: 'edit',
      };

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã®ãƒ­ãƒ¼ãƒ‰è©¦è¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰ã®æ¤œç´¢ã¨404ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      // ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ”¹å–„ã€‘: éåŒæœŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ­£ç¢ºãªå®Ÿè£…
      await expect(
        loadPluginComponent(invalidParams.nodeType, invalidParams.action)
      ).rejects.toThrow('ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: nonexistent'); // ã€ç¢ºèªå†…å®¹ã€‘: å­˜åœ¨ã—ãªã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã«å¯¾ã—ã¦é©åˆ‡ãªéåŒæœŸã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('éšå±¤æƒ…å ±çµ±åˆæ©Ÿèƒ½', () => {
    test('éšå±¤æƒ…å ±ã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆå–å¾—', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: useLoaderDataã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿çµ±åˆãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: éšå±¤æƒ…å ±ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆãƒ­ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: å…¨ã¦ã®å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒçµ±åˆã•ã‚ŒãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå–å¾—ã§ãã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«å®Œå…¨æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: ãƒ­ãƒ¼ãƒ€ãƒ¼é–¢æ•°ã®ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªéšå±¤æƒ…å ±ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: æœ‰åŠ¹ãªãƒ„ãƒªãƒ¼IDã€ãƒãƒ¼ãƒ‰IDã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—ã‚’è¨­å®š
      const routeParams: PluginRouteParams = {
        treeId: 'tree-123',
        pageNodeId: 'node-456',
        targetNodeId: 'node-789',
        nodeType: 'basemap',
        action: 'view',
      };

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: éšå±¤ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼é–¢æ•°ã®å®Ÿè¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ„ãƒªãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€ãƒãƒ¼ãƒ‰æƒ…å ±ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆå–å¾—
      const routeData = await HierarchicalPluginRouter.loadHierarchicalData(routeParams);

      // ã€çµæœæ¤œè¨¼ã€‘: çµ±åˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæœŸå¾…ã•ã‚Œã‚‹æ§‹é€ ã‚’æŒã¤ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: éšå±¤æƒ…å ±ã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ã®å®Œå…¨æ€§ã‚’æ¤œè¨¼
      expect(routeData).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«å–å¾—ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(routeData.treeContext).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ„ãƒªãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(routeData.targetNode).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(routeData.pluginData).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å›ºæœ‰ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(routeData.permissions).toBeInstanceOf(Array); // ã€ç¢ºèªå†…å®¹ã€‘: æ¨©é™é…åˆ—ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(routeData.treeContext.tree).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ„ãƒªãƒ¼æƒ…å ±ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
      expect(routeData.treeContext.currentNode).toBeDefined(); // ã€ç¢ºèªå†…å®¹ã€‘: ç¾åœ¨ãƒãƒ¼ãƒ‰æƒ…å ±ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });

    test('å­˜åœ¨ã—ãªã„treeIdã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ç„¡åŠ¹ãªãƒªã‚½ãƒ¼ã‚¹IDãŒé©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: å­˜åœ¨ã—ãªã„treeIdã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰è©¦è¡Œã‚’ãƒ†ã‚¹ãƒˆ
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã€é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿”ã•ã‚Œã‚‹
      // ğŸŸ¢ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å®šç¾©æ›¸ã®ç•°å¸¸ç³»ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«æº–æ‹ 

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: å­˜åœ¨ã—ãªã„ãƒ„ãƒªãƒ¼IDã‚’å«ã‚€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­˜åœ¨ã—ãªã„ãƒªã‚½ãƒ¼ã‚¹IDã‚’æŒ‡å®š
      const invalidParams: PluginRouteParams = {
        treeId: 'invalid-999',
        pageNodeId: 'node-456',
        targetNodeId: 'node-789',
        nodeType: 'basemap',
        action: 'view',
      };

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰è©¦è¡Œ
      // ã€å‡¦ç†å†…å®¹ã€‘: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¤œè¨¼
      await expect(HierarchicalPluginRouter.loadHierarchicalData(invalidParams)).rejects.toThrow(
        'æŒ‡å®šã•ã‚ŒãŸãƒ„ãƒªãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'
      ); // ã€ç¢ºèªå†…å®¹ã€‘: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¢
    });
  });

  describe('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶', () => {
    test('ãƒ«ãƒ¼ãƒˆè§£æ±ºå‡¦ç†ãŒ100msä»¥å†…ã§å®Œäº†ã™ã‚‹', async () => {
      // ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘: ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ãŒæº€ãŸã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
      // ã€ãƒ†ã‚¹ãƒˆå†…å®¹ã€‘: ãƒ«ãƒ¼ãƒˆè§£æ±ºå‡¦ç†ã®å®Ÿè¡Œæ™‚é–“ã‚’æ¸¬å®šã—SLAã‚’æ¤œè¨¼
      // ã€æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œã€‘: ãƒ«ãƒ¼ãƒˆè§£æ±ºãŒ100msä»¥å†…ã§å®Œäº†ã™ã‚‹
      // ã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æ”¹å–„ã€‘: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³äº‹å‰ç™»éŒ²ã«ã‚ˆã‚‹æ­£ç¢ºãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
      // ğŸŸ¡ ä¿¡é ¼æ€§ãƒ¬ãƒ™ãƒ«: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶æ–‡æ›¸ã«åŸºã¥ãå¦¥å½“ãªæ¨æ¸¬

      // ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™ã€‘: basemapãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®äº‹å‰ç™»éŒ²ã¨ãƒ«ãƒ¼ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
      // ã€åˆæœŸæ¡ä»¶è¨­å®šã€‘: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šã«å¿…è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç’°å¢ƒã®æ§‹ç¯‰
      const basemapPlugin: PluginDefinition = {
        nodeType: 'basemap',
        actions: {
          view: {
            component: React.lazy(() =>
              import('@hierarchidb/20-plugin-basemap').then((m) => ({ default: m.BaseMapView }))
            ),
            permissions: ['basemap:view'],
          },
        },
      };
      PluginRegistry.register(basemapPlugin);

      const routeParams: PluginRouteParams = {
        treeId: 'tree-123',
        pageNodeId: 'node-456',
        targetNodeId: 'node-789',
        nodeType: 'basemap',
        action: 'view',
      };

      // ã€å®Ÿéš›ã®å‡¦ç†å®Ÿè¡Œã€‘: ãƒ«ãƒ¼ãƒˆè§£æ±ºå‡¦ç†ã®å®Ÿè¡Œæ™‚é–“æ¸¬å®š
      // ã€å‡¦ç†å†…å®¹ã€‘: URLè§£æã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¸€é€£ã®å‡¦ç†æ™‚é–“è¨ˆæ¸¬
      // ã€æ”¹å–„å†…å®¹ã€‘: ã‚ˆã‚Šæ­£ç¢ºãªå®Ÿè¡Œæ™‚é–“æ¸¬å®šã®ãŸã‚ã®performance.now()ç›´æ¥ä½¿ç”¨
      const startTime = performance.now();
      await HierarchicalPluginRouter.resolveRoute(routeParams);
      const endTime = performance.now();
      const executionTime = endTime - startTime;

      // ã€çµæœæ¤œè¨¼ã€‘: å®Ÿè¡Œæ™‚é–“ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã‚’æº€ãŸã™ã“ã¨ã‚’ç¢ºèª
      // ã€æœŸå¾…å€¤ç¢ºèªã€‘: SLAè¦ä»¶ï¼ˆ100msä»¥å†…ï¼‰ã®éµå®ˆã‚’æ¤œè¨¼
      expect(executionTime).toBeLessThan(100); // ã€ç¢ºèªå†…å®¹ã€‘: ãƒ«ãƒ¼ãƒˆè§£æ±ºãŒ100msä»¥å†…ã§å®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª ğŸŸ¡
    });
  });
});
