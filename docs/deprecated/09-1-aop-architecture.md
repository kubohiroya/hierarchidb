9# 9 プラグインモジュールによるAOPでの機能拡張

## 9.1 統合プラグインアーキテクチャ

### 9.1.1 概要

AOPアーキテクチャにより、以下が実現される：

1. **拡張性**: 新しいノードタイプをプラグインとして追加可能
2. **保守性**: ノードタイプごとの処理が分離され、保守が容易
3. **再利用性**: 共通のライフサイクル処理を再利用
4. **型安全性**: TypeScriptの型システムを活用した安全な実装
5. **柔軟性**: eria-cartographの実装パターンを踏襲しつつ、hierarchidb固有の要件に対応

hierarchidbプロジェクトは、eria-cartographで実証済みの堅牢なノードタイプシステムを継承しながら、独自の拡張性を持つことができる。

### 9.1.1.2 workerの拡張

workerでのAPIサービスを、アスペクト志向でのクロスカット・ジョインポイントを用いて、拡張できるようにする。
とくに、APIサービスを通じて取り扱うノードのライフサイクルに応じて、ノードに紐づけたエンティティを管理することができるようにする。

**ライフサイクルマネージャー統合**: NodeLifecycleManagerによりライフサイクルフックが自動的に実行され、プラグイン固有の処理が適切なタイミングで呼び出される。

### 9.1.1.3 apiの拡張

エンティティおよびサブエンティティの種類ごとに、追加的なAPI定義を行う。

**Worker API拡張**: WorkerAPIExtensionsインターフェースを通じて、ノードタイプ固有のAPI操作を定義・実行可能。

### 9.1.1.4 uiの拡張

エンティティおよびサブエンティティの種類ごとに、追加的なReactコンポーネントを提供する。
これにより、ノードの作成とともに、エンティティ・サブエンティティを作成するダイアログを利用できるようにする。

**UIComponentRegistry統合**: 動的コンポーネント登録により、プラグイン固有のUIコンポーネントが自動的に利用可能になる。


### 9.1.2 統合プラグインアーキテクチャによる拡張モジュール

#### 9.1.2.1 ツリー分類とプラグイン配置

**Resourcesツリー専用プラグイン**:
- basemap, stylemap, shape, location, route, propertyresolver
- 地図表示に必要な各種リソースデータを管理
- 各プラグインは独立してリソースを提供
- 命名規則: プラグイン名称（NodeType 識別子を含む）はすべて単数形で統一する（例: basemap, stylemap, shape, location, route, propertyresolver, project）。

**Projectsツリー専用プラグイン**:
- project
- Resourcesツリーの複数ノードを参照・統合してプロジェクト表示
- TreeNode参照機能により他ツリーの内容を集約

**共通プラグイン**:
- folder
- Resources/Projects両ツリーで使用可能な汎用フォルダ機能

