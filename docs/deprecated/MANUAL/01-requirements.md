# システム要件と制約

# システム要件と制約

## この章について

この章では、HierarchiDBを正常に動作させるために必要なシステム要件、および使用時の制約事項について説明します。

**読むべき人**: システム管理者、インフラ担当者、導入責任者
**前提知識**: 基本的なWebブラウザとJavaScriptの知識
**読むタイミング**: 
- HierarchiDB導入前の要件確認
- パフォーマンス問題が発生した時の原因調査
- 大容量データ処理（spreadsheet等）を計画している時

この章では、機能要件、性能要件、セキュリティ要件を整理しています。特に、大容量spreadsheetデータの処理や地理情報データの表示に関する制約を理解することで、適切なシステム設計と運用が可能になります。また、各プラグイン（BaseMap、StyleMap、Shape、Spreadsheet、Project）の要件も含まれています。

## 機能要件

### 基本要件

#### データ管理
- ツリー構造によるデータの階層的管理
- 無制限の階層深度サポート
- 大量データ（10万ノード以上）の効率的な処理

#### 編集機能
- リアルタイム編集とプレビュー
- ワーキングコピーによる安全な編集
- ドラフト状態の保存と再開
- 完全なUndo/Redo機能

#### プラグイン拡張
- プラグインによる機能拡張
- カスタムノードタイプの定義
- エンティティライフサイクルの自動管理

### 性能要件

#### レスポンス時間
- UI操作: 100ms以内
- データ読み込み: 1秒以内（1000ノード）
- バッチ処理: プログレス表示付き非同期処理

#### スケーラビリティ
- 同時編集ユーザー数: 1（シングルユーザー）
- 最大ノード数: 100万ノード
- 最大ツリー深度: 制限なし（実用上20階層程度）

## 非機能要件

### セキュリティ
- OAuth2/OIDC による認証
- JWT トークンによる認可
- クライアントサイドでのデータ暗号化（オプション）

### 信頼性
- データの自動保存（5秒ごと）
- エラー時の自動リカバリー
- データ整合性チェック

### 保守性
- TypeScript による型安全性
- 包括的なテストカバレッジ（70%以上）
- ESLint/Prettier によるコード品質管理

### 互換性
- モダンブラウザサポート（Chrome, Firefox, Safari, Edge）
- モバイルブラウザ対応（表示のみ）
- プログレッシブエンハンスメント

## システム制約

### 技術的制約

#### ブラウザAPI依存
- IndexedDB（必須）
- Web Workers（必須）
- Service Workers（オプション）

#### ストレージ制限
- IndexedDB容量: ブラウザとデバイスに依存
- 推奨空き容量: 1GB以上

#### ネットワーク
- オフライン動作: 基本機能は利用可能
- 外部API連携: オンライン必須

### 開発制約

#### 技術スタック固定
- React 19+
- TypeScript 5+
- Material-UI v5
- Dexie.js

#### アーキテクチャ制約
- 4層アーキテクチャの維持
- Worker層でのデータ処理
- Comlink によるRPC通信

## データモデル制約

### エンティティ分類
2×3のマトリックス分類を厳守：
- 紐付け: Peer / Group / Relation
- ライフサイクル: Persistent / Ephemeral

### ワーキングコピー
- オリジナルに対して最大1つ
- 同一IDの使用
- EphemeralDBへの保存

### データベース分離
- CoreDB: 永続データのみ
- EphemeralDB: 一時データのみ

## プラグイン開発制約

### 必須実装
- NodeTypeDefinition
- EntityHandler
- ダイアログコンポーネント

### 命名規則
- ノードタイプ: 小文字（例: `basemap`）
- エンティティ: PascalCase + Entity（例: `BaseMapEntity`）
- ハンドラー: PascalCase + Handler（例: `BaseMapHandler`）

### ライフサイクルフック
- `afterCreate`
- `beforeUpdate`
- `afterUpdate`
- `beforeDelete`
- `afterDelete`

## 運用制約

### デプロイメント
- 静的ファイルホスティング対応
- CDN配信可能
- GitHub Pages対応

### バックアップ
- IndexedDBの定期エクスポート推奨
- JSON形式でのデータ保存

### モニタリング
- エラーログの収集
- パフォーマンスメトリクス
- ユーザー行動分析（オプション）

## 今後の拡張性考慮

### 将来的な機能追加
- リアルタイム協調編集
- サーバーサイド永続化
- プラグインマーケットプレイス

### スケーラビリティ
- マイクロフロントエンド対応
- Web Assembly統合
- ストリーミングデータ処理

## 次のステップ

- [アーキテクチャ概要](./02-architecture-overview.md)
- [開発環境構築](./05-dev-environment.md)
- [デプロイメント](./06-deployment.md)