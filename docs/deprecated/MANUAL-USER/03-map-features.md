# 地図機能ガイド

## 地図機能の概要

HierarchiDBの地図機能（BaseMapプラグイン）では、基本的な地図の表示と設定を行うことができます。MapLibre GLを使用した地図表示により、様々な地図スタイルを利用できます。

## 基図（背景地図）の設定

### 1. 基図の追加
1. プロジェクト内を右クリック
2. 「基図を追加」を選択
3. 基図設定ダイアログが開きます

### 2. 利用可能な地図タイプ
**OpenStreetMap（推奨）:**
- 無料で利用可能
- 世界中をカバー
- コミュニティにより更新

**地理院地図:**
- 日本国内詳細
- 等高線・地形図
- 航空写真

**その他の地図:**
- Mapbox（要API キー）
- Google Maps（要API キー）
- カスタムタイル（上級者向け）

### 3. 基図の基本設定
**表示設定:**
- **初期中心位置**: 地図を開いたときの中心座標（経度、緯度）
- **初期ズームレベル**: 拡大率（1-20、数字が大きいほど詳細）
- **ベアリング**: 地図の回転角度（0-360度）
- **ピッチ**: 地図の傾き（0-60度、3D表示用）

## 地図の操作方法

### マウスによる操作
| 操作 | 機能 |
|------|------|
| ドラッグ | 地図の移動 |
| ホイール | ズームイン・アウト |
| ダブルクリック | その場所を中心にズームイン |
| 右クリック | コンテキストメニュー表示 |

### キーボードショートカット
| キー | 機能 |
|------|------|
| ↑↓←→ | 地図の移動 |
| + / - | ズームイン・アウト |
| Home | 初期位置に戻る |
| Ctrl+マウス | 地図の回転 |

### タッチ操作（タブレット・スマホ）
- **ピンチ**: ズームイン・アウト
- **ドラッグ**: 地図の移動
- **回転**: 2本指で回転操作

## スタイル設定

### 1. スタイルの作成
1. プロジェクト内を右クリック
2. 「スタイル設定を追加」を選択
3. スタイル設定ダイアログで詳細を設定

### 2. 色とスタイルの設定
**線の設定:**
- **色**: RGB、HEX、色名で指定
- **太さ**: 1-10ピクセル
- **スタイル**: 実線、破線、点線
- **透明度**: 0-100%

**塗りつぶしの設定:**
- **塗りつぶし色**: エリアの内部色
- **境界線色**: エリアの輪郭色
- **パターン**: 無地、ストライプ、ドット
- **透明度**: 重なりを見やすくする

### 3. 条件付きスタイル
データの値に応じて色を変える設定：

**例：人口密度による色分け**
- 1000人/km²未満: 薄い青
- 1000-5000人/km²: 青
- 5000人/km²以上: 濃い青

**設定手順:**
1. スタイル設定で「条件付きスタイル」を選択
2. 条件とする項目を選択
3. 値の範囲と対応する色を設定

## データの地図表示

### 1. 座標データの表示
**ポイントデータ:**
- CSV ファイルに緯度・経度の列があれば自動で地図表示
- カスタムマーカーアイコン設定可能
- クリック時のポップアップ表示

**ラインデータ:**
- 移動経路や境界線の表示
- GPS ログファイルの読み込み
- 線のスタイル詳細設定

**エリアデータ:**
- 行政区域や調査範囲の表示
- GeoJSON、KML ファイル対応
- 面積の自動計算

### 2. データのインポート方法
**対応ファイル形式:**
- **CSV**: 緯度・経度列があるもの
- **GeoJSON**: 地理データ標準形式
- **KML**: Google Earth形式
- **Shapefile**: GIS標準形式

**インポート手順:**
1. プロジェクトの「データ」フォルダを右クリック
2. 「地理データをインポート」を選択
3. ファイルを選択してアップロード
4. 座標系と項目の設定
5. インポート実行

### 3. 座標系の設定
**主要な座標系:**
- **WGS84 (EPSG:4326)**: GPS標準、世界共通
- **平面直角座標系**: 日本の測量用
- **UTM**: 世界測地系

**注意点:**
- データの座標系を正確に指定
- 異なる座標系のデータは自動変換
- 不明な場合はWGS84を試行

## 地図の印刷・出力

### 1. 地図画像の出力
1. ツールバーの「エクスポート」ボタン
2. 「地図画像として出力」を選択
3. 出力設定：
   - **サイズ**: A4、A3、カスタム
   - **解像度**: 150-300 DPI
   - **形式**: PNG、JPEG、PDF

### 2. 印刷設定
**用紙設定:**
- 用紙サイズと向き
- 余白の設定
- タイトルと凡例の配置

**表示設定:**
- 出力範囲の指定
- レイヤーの選択
- 縮尺の表示

## トラブルシューティング

### よくある問題

**地図が表示されない:**
- インターネット接続を確認
- ブラウザのJavaScriptが有効か確認
- 地図サービスのAPI制限確認

**データが地図に表示されない:**
- 座標データの形式確認（緯度・経度の順序）
- 座標系の設定確認
- データの範囲が表示エリア内か確認

**地図の動作が重い:**
- 表示レイヤー数を減らす
- データ量の多いレイヤーを一時非表示
- ブラウザのメモリ使用量確認

### エラーメッセージの対処

**「座標データが無効です」:**
- 緯度は-90〜90、経度は-180〜180の範囲で入力
- 数値以外の文字が含まれていないか確認

**「地図サービスに接続できません」:**
- インターネット接続状況確認
- 別の基図サービスに変更を試行

## 次のステップ

地図機能に慣れたら、以下の機能も活用してみてください：

- **[表データ管理](./04-spreadsheet-features.md)** - 地図と連携した表データ処理
- **[データ分析](./05-data-analysis.md)** - 地理的データの統計分析
- **[自動化機能](./06-automation.md)** - 定期的な地図データ更新