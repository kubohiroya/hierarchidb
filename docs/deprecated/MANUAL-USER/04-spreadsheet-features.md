# 表データ管理ガイド（スプレッドシート機能）

## 表データ機能の概要

HierarchiDBの表データ機能では、CSV、Excel、Googleスプレッドシートなどのデータをインポートし、効率的に管理・分析できます。地図機能と連携することで、位置情報付きデータの可視化も可能です。

## 対応ファイル形式

### インポート可能な形式
- **CSV**: カンマ区切りファイル（最も推奨）
- **TSV**: タブ区切りファイル
- **Excel**: .xlsx、.xls ファイル
- **JSON**: 構造化データ
- **Google Sheets**: URL経由でのインポート

### エクスポート可能な形式
- **CSV**: 他のソフトウェアとの互換性
- **Excel**: Excelでの詳細分析用
- **JSON**: プログラムでの処理用
- **PDF**: レポート形式での出力

## データのインポート

### 1. CSVファイルのインポート
1. プロジェクト内の「表データ」フォルダを右クリック
2. 「表データをインポート」を選択
3. CSVファイルを選択してアップロード

### 2. インポート設定
**文字エンコーディング:**
- **UTF-8**: 現在の標準（推奨）
- **Shift_JIS**: 日本語Windows環境
- **EUC-JP**: Unix/Linux環境
- **自動判定**: ファイル内容から推測

**区切り文字:**
- **カンマ（,）**: CSV標準
- **タブ**: TSVファイル用
- **セミコロン（;）**: ヨーロッパ形式
- **その他**: カスタム区切り文字

**データ設定:**
- **ヘッダー行**: 1行目が列名かどうか
- **データ型自動判定**: 数値、日付、文字列の自動認識
- **空セルの扱い**: 空白、ゼロ、NULLの選択

### 3. プレビューと確認
インポート前にデータの内容を確認：
- 最初の10行を表示
- 各列のデータ型確認
- 問題のあるデータの特定

## 表データの編集

### 1. セルの編集
**基本編集:**
- セルをダブルクリックで編集モード
- Tab キーで次のセルに移動
- Enter キーで下のセルに移動
- Escape キーで編集をキャンセル

**データ型:**
- **文字列**: テキストデータ
- **数値**: 計算可能な数字
- **日付**: 日付・時刻データ
- **真偽値**: はい/いいえ、True/False

### 2. 行・列の操作
**行の操作:**
- 行番号を右クリック→「行を挿入」「行を削除」
- 複数行選択でまとめて操作
- 行の並び替え（ドラッグ&ドロップ）

**列の操作:**
- 列ヘッダーを右クリック→「列を挿入」「列を削除」
- 列幅の調整（ヘッダー境界をドラッグ）
- 列の並び替え

### 3. データの検索・置換
**検索機能:**
1. Ctrl+F で検索ダイアログを開く
2. 検索したい文字列を入力
3. 「次を検索」で該当セルに移動

**置換機能:**
1. Ctrl+H で置換ダイアログを開く
2. 「検索する文字列」と「置換後の文字列」を入力
3. 「すべて置換」または「一つずつ置換」を選択

## データの並び替えとフィルタ

### 1. データの並び替え
**単一列での並び替え:**
1. 並び替えたい列のヘッダーをクリック
2. 昇順（小→大）または降順（大→小）を選択

**複数列での並び替え:**
1. データ範囲を選択
2. 「データ」メニュー→「並び替え」
3. 第1キー、第2キーを設定

### 2. フィルタ機能
**オートフィルタの設定:**
1. データ範囲を選択
2. 「データ」メニュー→「オートフィルタ」
3. 各列ヘッダーにドロップダウンが表示

**フィルタ条件の設定:**
- **完全一致**: 特定の値のみ表示
- **部分一致**: 文字列の一部が一致
- **数値範囲**: 以上、以下、範囲指定
- **日付範囲**: 期間指定

### 3. 高度なフィルタ
**複数条件フィルタ:**
- AND条件: すべての条件を満たす
- OR条件: いずれかの条件を満たす

**カスタムフィルタ:**
- 正規表現による詳細検索
- 計算式による条件設定

## 集計・計算機能

### 1. 基本的な関数
**統計関数:**
- `SUM()`: 合計値
- `AVERAGE()`: 平均値
- `COUNT()`: データ数
- `MAX()`, `MIN()`: 最大値、最小値

**使用例:**
```
=SUM(A1:A10)        // A1からA10の合計
=AVERAGE(B:B)       // B列全体の平均
=COUNT(C1:C100)     // C1からC100の数値個数
```

### 2. 文字列関数
- `CONCATENATE()`: 文字列の結合
- `LEFT()`, `RIGHT()`: 文字列の一部取得
- `FIND()`, `SEARCH()`: 文字列検索

### 3. 日付関数
- `TODAY()`: 今日の日付
- `YEAR()`, `MONTH()`, `DAY()`: 年月日の抽出
- `DATEDIF()`: 日付の差分計算

### 4. ピボットテーブル
**作成手順:**
1. データ範囲を選択
2. 「挿入」メニュー→「ピボットテーブル」
3. 行・列・値フィールドを設定

**活用例:**
- 地域別売上集計
- 月別データ推移
- カテゴリ別統計

## 地図連携機能

### 1. 地理データの処理
**座標データの認識:**
- 「緯度」「経度」列を自動認識
- 「住所」列から座標を自動取得
- 郵便番号から大まかな位置特定

**地図表示設定:**
1. 表データを選択
2. 「地図」ボタンをクリック
3. 座標列を指定
4. マーカースタイルを設定

### 2. 地図とデータの同期
**表から地図への反映:**
- 表の行を選択→地図上のポイントがハイライト
- データの変更→地図表示が自動更新
- フィルタ適用→地図上の表示も連動

**地図から表への反映:**
- 地図上のポイントクリック→対応する行が選択
- 地図範囲の変更→表示データの絞り込み

## データの検証・クリーニング

### 1. データ品質チェック
**自動検証機能:**
- 重複データの検出
- 必須項目の空白チェック
- データ型の不整合検出
- 異常値の特定

**検証結果の表示:**
- 問題のあるセルを赤色でハイライト
- エラー内容をツールチップで表示
- 修正候補の提案

### 2. データクリーニング
**一括修正機能:**
- 全角・半角の統一
- 余分な空白の削除
- 大文字・小文字の統一
- 日付形式の統一

**手動修正:**
- セル単位での修正
- 置換機能による一括修正
- 正規表現による高度な修正

## エクスポート・共有

### 1. データの出力
**ファイル出力:**
1. 出力したいデータを選択
2. 「ファイル」メニュー→「エクスポート」
3. 出力形式を選択
4. オプション設定（ヘッダー行、エンコーディング等）

**印刷出力:**
- ページ設定（用紙サイズ、向き）
- 印刷範囲の指定
- ヘッダー・フッターの設定

### 2. レポート作成
**サマリーレポート:**
- データの統計情報
- グラフ・チャートの自動生成
- PDF形式での出力

**詳細レポート:**
- すべてのデータを含む詳細一覧
- フィルタ・並び替え結果の反映
- 地図と表の組み合わせ表示

## トラブルシューティング

### よくある問題

**文字化けが発生する:**
- 文字エンコーディングの設定確認
- BOM付きUTF-8の使用
- 保存時の文字コード指定

**計算式が動作しない:**
- セル参照の記述確認（A1、B2:C10等）
- 関数名のスペルチェック
- データ型の一致確認

**大きなファイルが開けない:**
- ブラウザのメモリ制限
- ファイルサイズの確認（推奨：10MB以下）
- データの分割を検討

**地図に表示されない:**
- 座標データの形式確認
- 緯度・経度の範囲チェック
- 座標系の設定確認

### パフォーマンス最適化

**大量データの処理:**
- 必要な列のみをインポート
- データの事前フィルタリング
- 分割ファイルでの処理

**メモリ使用量の削減:**
- 不要なワークシートの削除
- 計算式の最適化
- 定期的なブラウザ再起動

## 次のステップ

表データ機能に慣れたら、以下の機能も活用してみてください：

- **[データ分析](./05-data-analysis.md)** - 統計分析とグラフ作成
- **[自動化機能](./06-automation.md)** - 定期処理とバッチ機能
- **[外部連携](./07-integration.md)** - 他システムとのデータ連携