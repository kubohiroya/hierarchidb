# StyleMap Plugin Phase 3: UI実装

## フェーズ概要

- **期間**: 3週間 (15営業日)
- **目標**: React UI・ダイアログ・フォーム・プレビューの完成
- **成果物**: ステップ式ダイアログ、リアルタイムプレビュー、ユーザー操作UI
- **担当**: 開発チーム
- **前提条件**: Phase 2 (TASK-0081〜0100) 完了済み

## 週次計画

### Week 1: 基本UIコンポーネント
- **目標**: フォーム・プレビュー基盤の実装
- **成果物**: ファイルアップロード、カラー設定フォーム、プレビューエリア

### Week 2: ステップ式ダイアログ
- **目標**: マルチステップUI・ナビゲーション実装
- **成果物**: ステップ式ダイアログ、状態管理、非線形ナビゲーション

### Week 3: 統合・アクセシビリティ・最適化
- **目標**: UI統合とユーザビリティ向上
- **成果物**: アクセシビリティ対応、レスポンシブデザイン、パフォーマンス最適化

## 日次タスク

### Week 1: 基本UIコンポーネント

#### Day 41 (TASK-0101): ファイルアップロードコンポーネント

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-001, REQ-102, NFR-201 🟢
- **依存タスク**: TASK-0100 (Phase 2完了)
- **実装詳細**:
  - StyleMapFileUpload React コンポーネント
  - ドラッグ&ドロップファイルアップロード
  - ファイル形式・サイズ検証表示
  - プログレス表示・キャンセル機能
  - モバイル対応・レスポンシブデザイン
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] ローディング状態の明確な表示
  - [ ] エラー表示の適切な配置
  - [ ] モバイル端末での操作性確保
  - [ ] アクセシビリティ: ファイル選択のキーボード操作対応
- **完了条件**:
  - [ ] CSV/TSVファイルのアップロードが可能
  - [ ] 不正ファイルの適切なエラー表示
  - [ ] プログレス表示による進捗把握
  - [ ] レスポンシブデザイン対応
- **注意事項**: 🟢 eria-cartographアップロードUIパターン参考

#### Day 42 (TASK-0102): カラーマッピング設定フォーム

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-003, REQ-301, REQ-302 🟢
- **依存タスク**: TASK-0101
- **実装詳細**:
  - StyleMapColorForm React コンポーネント
  - アルゴリズム選択 (linear/logarithmic/quantile/categorical)
  - 色空間選択 (HSV/RGB)
  - 色相範囲スライダー (hueStart/hueEnd)
  - 彩度・明度設定スライダー
  - MapLibreスタイルプロパティ選択
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] リアルタイムプレビュー更新
  - [ ] スライダーの視覚的フィードバック
  - [ ] 色相範囲の直感的な表示
  - [ ] アクセシビリティ: スライダーのARIAラベル設定
- **完了条件**:
  - [ ] 全カラーマッピング設定が操作可能
  - [ ] 設定変更の即座な反映
  - [ ] Material-UIデザインシステム準拠
- **注意事項**: 🟢 eria-cartographカラー設定UIパターン参考

#### Day 43 (TASK-0103): データプレビューコンポーネント

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-105, NFR-202 🟢
- **依存タスク**: TASK-0102
- **実装詳細**:
  - StyleMapPreview React コンポーネント
  - テーブルデータ表示 (TanStack Table)
  - カラーマッピング結果の視覚的表示
  - 仮想スクローリング (大容量データ対応)
  - ソート・検索機能
  - MapLibreスタイル適用済みプレビュー
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 大容量データでの高速表示
  - [ ] カラーマッピング結果の明確な視覚化
  - [ ] ソート・検索の直感的な操作
  - [ ] アクセシビリティ: テーブル読み上げ対応
- **完了条件**:
  - [ ] 10万行データの高速表示
  - [ ] カラーマッピング結果の正確な表示
  - [ ] 仮想スクローリングによる性能確保
- **注意事項**: 🟢 TanStack Table使用による高性能実現

#### Day 44 (TASK-0104): フィルタリングUIコンポーネント

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-104, REQ-303 🟢
- **依存タスク**: TASK-0103
- **実装詳細**:
  - StyleMapFilters React コンポーネント
  - フィルタルール追加・削除UI
  - アクション選択 (Include/Exclude/Pattern)
  - 正規表現パターン入力・検証
  - フィルタ結果のリアルタイム更新
  - フィルタチェーンの視覚的表示
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] フィルタルール追加の簡単な操作
  - [ ] 正規表現エラーの明確な表示
  - [ ] フィルタ結果の即座な反映
  - [ ] アクセシビリティ: フォームラベルの適切な設定
- **完了条件**:
  - [ ] 4種類のフィルタアクションが操作可能
  - [ ] 正規表現による柔軟なフィルタリング
  - [ ] フィルタ変更時の即座な結果更新
- **注意事項**: 🟢 eria-cartographフィルタUIパターン参考

#### Day 45 (TASK-0105): UIコンポーネント統合テスト

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: NFR-202 🟢
- **依存タスク**: TASK-0104
- **実装詳細**:
  - コンポーネント間の連携テスト
  - 状態管理の統合確認
  - イベントフロー検証
  - エラーハンドリング統合
  - パフォーマンス・レスポンス性測定
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 500ms以内のプレビュー更新確保
  - [ ] スムーズなユーザー操作体験
  - [ ] 一貫したデザインシステム適用
  - [ ] アクセシビリティ: フォーカス管理の確認
- **完了条件**:
  - [ ] 全UIコンポーネントが連携動作
  - [ ] レスポンス性能要件達成
  - [ ] エラー処理の適切な統合
- **注意事項**: 🟡 NFR-002 (500ms以内更新) 要件確保

### Week 2: ステップ式ダイアログ

#### Day 46 (TASK-0106): ステップ式ダイアログ基盤

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-504, NFR-202, TECH-007 🟢
- **依存タスク**: TASK-0105
- **実装詳細**:
  - StyleMapDialog React コンポーネント
  - MultiStepDialog基盤クラス
  - ステップナビゲーション (戻る・進む・完了)
  - 非線形ナビゲーション対応
  - ダイアログ状態管理 (useReducer)
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 進捗インジケーターの明確な表示
  - [ ] ナビゲーションボタンの適切な状態管理
  - [ ] ダイアログのレスポンシブサイズ調整
  - [ ] アクセシビリティ: キーボードナビゲーション対応
- **完了条件**:
  - [ ] ステップ間の自由な移動が可能
  - [ ] ダイアログ状態の適切な管理
  - [ ] Material-UIダイアログシステム統合
- **注意事項**: 🟢 hierarchidbダイアログパターン準拠

#### Day 47 (TASK-0107): ファイル選択・アップロードステップ

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-001, REQ-006 🟢
- **依存タスク**: TASK-0106
- **実装詳細**:
  - Step1: ファイル選択・アップロード
  - キャッシュヒット確認・表示
  - ファイル解析結果のプレビュー
  - エラー表示・リトライ機能
  - 次ステップへの進行条件確認
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] アップロード進捗の分かりやすい表示
  - [ ] キャッシュヒット時の高速表示
  - [ ] エラー時の適切なガイダンス
  - [ ] アクセシビリティ: 進捗状況の音声読み上げ対応
- **完了条件**:
  - [ ] ファイルアップロードが正常に動作
  - [ ] キャッシュシステムとの統合動作
  - [ ] 適切なエラーハンドリングと回復
- **注意事項**: 🟢 Phase 2実装との統合

#### Day 48 (TASK-0108): カラムマッピング設定ステップ

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-002, REQ-003 🟢
- **依存タスク**: TASK-0107
- **実装詳細**:
  - Step2: キー・値カラム選択
  - カラム候補の自動検出・推奨
  - データ型表示・統計情報
  - カラムマッピングプレビュー
  - 無効な組み合わせのエラー表示
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] カラム候補の分かりやすい表示
  - [ ] データ統計情報の視覚的表示
  - [ ] 推奨カラムの明確なハイライト
  - [ ] アクセシビリティ: カラム説明の読み上げ対応
- **完了条件**:
  - [ ] キー・値カラムの適切な選択が可能
  - [ ] 自動推奨による操作性向上
  - [ ] 無効な組み合わせの適切な検出
- **注意事項**: 🟢 データ分析による推奨機能実装

#### Day 49 (TASK-0109): カラーマッピング設定ステップ

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-003, REQ-301, REQ-302 🟢
- **依存タスク**: TASK-0108
- **実装詳細**:
  - Step3: カラーマッピング詳細設定
  - アルゴリズム選択・パラメータ調整
  - 色空間・色相範囲設定
  - MapLibreプロパティ選択
  - リアルタイムプレビュー統合
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 設定変更の即座なプレビュー反映
  - [ ] カラーアルゴリズムの視覚的説明
  - [ ] 色相範囲の直感的な操作
  - [ ] アクセシビリティ: カラー設定の代替テキスト提供
- **完了条件**:
  - [ ] 4つのアルゴリズムすべてが設定可能
  - [ ] リアルタイムプレビューの高速動作
  - [ ] 設定内容の適切な永続化
- **注意事項**: 🟢 Phase 2カラーマッピング機能との統合

#### Day 50 (TASK-0110): フィルタリング・最終確認ステップ

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-104, REQ-303 🟢
- **依存タスク**: TASK-0109
- **実装詳細**:
  - Step4: フィルタルール設定
  - Step5: 最終確認・保存
  - フィルタ結果のプレビュー表示
  - StyleMap設定サマリー表示
  - 保存・キャンセル・再編集機能
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] フィルタ結果の分かりやすい表示
  - [ ] 設定内容のサマリー表示
  - [ ] 保存前の最終確認
  - [ ] アクセシビリティ: 確認内容の構造化された読み上げ
- **完了条件**:
  - [ ] フィルタリング機能の完全統合
  - [ ] 設定内容の包括的な確認表示
  - [ ] 保存・編集フローの完成
- **注意事項**: 🟢 UX設計による操作性確保

### Week 3: 統合・アクセシビリティ・最適化

#### Day 51 (TASK-0111): Working Copy統合・未保存警告

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: REQ-007, REQ-203 🟢
- **依存タスク**: TASK-0110
- **実装詳細**:
  - Working Copy状態管理統合
  - 編集内容の自動保存・復元
  - 未保存変更の検知・警告
  - ダイアログ終了時の確認表示
  - セッションストレージによる状態永続化
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 未保存変更の明確な表示
  - [ ] ダイアログ終了時の適切な警告
  - [ ] セッション復帰時の状態復元
  - [ ] アクセシビリティ: 警告の重要度適切なARIA設定
- **完了条件**:
  - [ ] Working Copyとの完全統合
  - [ ] データ損失防止機能の実装
  - [ ] ユーザー操作の安全性確保
- **注意事項**: 🟢 hierarchidb Working Copyパターン準拠

#### Day 52 (TASK-0112): アクセシビリティ対応・WCAG準拠

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: NFR-201 🟡
- **依存タスク**: TASK-0111
- **実装詳細**:
  - WCAG 2.1 AA準拠対応
  - ARIAラベル・ロール・プロパティ設定
  - キーボードナビゲーション最適化
  - スクリーンリーダー対応
  - コントラスト比・フォントサイズ調整
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] タブオーダーの論理的な設定
  - [ ] フォーカス表示の明確な視覚化
  - [ ] 音声読み上げの自然な流れ
  - [ ] 色に依存しない情報伝達
- **完了条件**:
  - [ ] WCAG 2.1 AA基準の達成
  - [ ] キーボードのみでの全操作可能
  - [ ] スクリーンリーダーでの適切な読み上げ
- **注意事項**: 🟡 アクセシビリティ要件への完全対応

#### Day 53 (TASK-0113): レスポンシブデザイン・モバイル対応

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: NFR-201 🟡
- **依存タスク**: TASK-0112
- **実装詳細**:
  - レスポンシブブレークポイント対応
  - モバイル端末での操作性最適化
  - タッチ操作・ジェスチャー対応
  - 画面サイズ別レイアウト調整
  - モバイルファーストデザイン
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 小画面での情報階層の最適化
  - [ ] タッチターゲットサイズの確保
  - [ ] スワイプ・ピンチ操作の対応
  - [ ] 縦・横画面回転への対応
- **完了条件**:
  - [ ] 全画面サイズでの適切な表示
  - [ ] モバイル端末での快適な操作
  - [ ] タッチ操作の正確な認識
- **注意事項**: 🟡 モバイルユーザビリティの確保

#### Day 54 (TASK-0114): パフォーマンス最適化・UI応答性

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: NFR-002, TECH-008 🟡
- **依存タスク**: TASK-0113
- **実装詳細**:
  - React コンポーネント最適化 (useMemo/useCallback)
  - 仮想スクローリングのパフォーマンス調整
  - デバウンス機能の最適化 (300ms)
  - メモリリーク防止・クリーンアップ
  - レンダリング回数の最小化
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] 500ms以内のプレビュー更新維持
  - [ ] スムーズなスクロール・操作感
  - [ ] 大容量データでの快適な操作
  - [ ] ローディング状態の適切な表示
- **完了条件**:
  - [ ] プレビュー更新500ms以内達成
  - [ ] 10万行データでの快適なUI操作
  - [ ] メモリリークの完全防止
- **注意事項**: 🟡 UI応答性要件の厳格な達成

#### Day 55 (TASK-0115): E2E統合テスト・総合品質確認

- [ ] **タスク完了**
- **推定工数**: 8時間
- **タスクタイプ**: TDD
- **要件リンク**: 全Phase 3要件 🟢
- **依存タスク**: TASK-0114
- **実装詳細**:
  - エンドツーエンドUIテスト
  - ユーザーシナリオ完全テスト
  - クロスブラウザ動作確認
  - パフォーマンス総合テスト
  - アクセシビリティ総合監査
- **テスト要件**:
  - [ ] コンポーネント描画テスト
  - [ ] プロパティ変更テスト
  - [ ] イベントハンドリングテスト
- **エラーハンドリング要件**:
  - [ ] 不正な設定値に対するバリデーション
  - [ ] UI操作エラー時の適切なフィードバック
  - [ ] 通信エラー時のリトライ・回復機能
- **UI/UX要件**:
  - [ ] ユーザージャーニー全体の流暢性
  - [ ] エラー処理の一貫性
  - [ ] デザインシステムの統一性
  - [ ] 全アクセシビリティ要件の達成
- **完了条件**:
  - [ ] 全E2Eテストの成功
  - [ ] 主要ブラウザでの動作確認
  - [ ] パフォーマンス・アクセシビリティ要件達成
  - [ ] ユーザビリティの総合的な確認
- **注意事項**: 🟢 Phase 3機能の完全統合確認

## フェーズ完了基準

- [ ] 全タスクが完了している (15/15)
- [ ] React UIコンポーネントが完全に動作
- [ ] ステップ式ダイアログが統合済み
- [ ] リアルタイムプレビューが500ms以内で更新
- [ ] アクセシビリティ (WCAG 2.1 AA) に準拠
- [ ] レスポンシブデザインでモバイル対応済み
- [ ] Working Copy機能がUI層で統合済み
- [ ] E2Eテストで全ユーザーシナリオが動作
- [ ] パフォーマンス・ユーザビリティ要件を達成

## 次フェーズへの引き継ぎ事項

### 🟢 完成したUI機能
- React UIコンポーネント群 (アップロード、フォーム、プレビュー、フィルタ)
- ステップ式ダイアログシステム
- リアルタイムプレビュー機能
- Working Copy統合UI
- アクセシビリティ・レスポンシブデザイン対応

### 🟡 Phase 4で実装予定
- 最終統合テスト・品質保証
- パフォーマンス最終調整
- ドキュメント・運用ガイド作成

### 📋 注意点
- UI応答性の継続的な監視
- アクセシビリティ要件の維持
- モバイルユーザビリティの継続確認

## 振り返り

### 計画との差異
- {実装後に記録}

### 学習事項
- {UI/UX実装の学習事項を記録}

### 改善点
- {Phase 4・将来改善点を記録}