import{w as k,b as E,a as R,u as L,r as N}from"./vendor-react-BP9jdMJE.js";import{j as t}from"./jsx-runtime-D_zvdyIk.js";import{l as P}from"./loader-D5if6doL.js";import{W as A}from"./index-SzJX3EJy.js";import{S as B,U as _}from"./index-C9Ezzdro.js";import{T as $}from"./index-CyZumM2T.js";import{c as b,B as c,T as F,C as M}from"./Box-zDrc8-aq.js";import{A as z,T as H}from"./Toolbar-CLindvYh.js";import{B as u}from"./Button-SDpdNXaB.js";import{R as V}from"./RestoreFromTrash-C4zCvTlp.js";import"./createSimplePaletteValueFilter-BuD9q6B8.js";import"./assertThisInitialized-C6AqJUPC.js";import"./useThemeProps-BB4YCwI3.js";import"./index-LrBs_WFz.js";import"./TransitionGroup-wYxCXXF3.js";import"./i18n-6N6UC6AY-BJA6as56.js";import"./useThemeWithoutDefault-B_xv69Jx.js";import"./Paper-hI1Q5KHP.js";const G=b(t.jsx("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"})),U=b(t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}));async function de(f){const r=await P(f.params);if(r.tree){const m=await r.client.getAPI().getNode({treeNodeId:r.tree.treeTrashRootNodeId}),h=await r.client.getAPI().getChildren({parentTreeNodeId:r.tree.treeTrashRootNodeId});return{...r,trashRootNode:m,trashItems:h}}return r}const ce=k(function(){var w,y,T,j,C,v;const r=E(),[m]=R(),h=L(),s=m.get("mode")||"restore",[n,g]=N.useState([]),[p,i]=N.useState(!1),x=async()=>{if(n.length!==0){i(!0);try{const a=await(await A.getSingleton()).getAPI().recoverFromTrash({payload:{nodeIds:n},commandId:`recover-${Date.now()}`,groupId:`group-${Date.now()}`,kind:"recoverFromTrash",issuedAt:Date.now()});a.success?window.location.reload():console.error("Failed to restore:",a.error)}catch(e){console.error("Error restoring items:",e)}finally{i(!1)}}},I=async()=>{var e;if(confirm("Are you sure you want to permanently delete all items in the trash? This action cannot be undone.")){i(!0);try{const a=(await A.getSingleton()).getAPI(),l=((e=r.trashItems)==null?void 0:e.map(d=>d.treeNodeId))||[];if(l.length>0){const d=await a.remove({payload:{nodeIds:l},commandId:`delete-${Date.now()}`,groupId:`group-${Date.now()}`,kind:"remove",issuedAt:Date.now()});d.success?window.location.reload():console.error("Failed to empty trash:",d.error)}}catch(o){console.error("Error emptying trash:",o)}finally{i(!1)}}},D=(r.trashItems||[]).map(e=>({...e,id:e.treeNodeId,nodeType:e.treeNodeType,children:void 0})),S=[{id:"name",label:"Name",sortable:!0,width:300,render:(e,o)=>o.name},{id:"nodeType",label:"Type",sortable:!0,width:120,render:(e,o)=>o.nodeType},{id:"deletedAt",label:"Deleted",sortable:!0,width:160,render:(e,o)=>o.updatedAt?new Date(o.updatedAt).toLocaleDateString():""}];return t.jsxs(c,{sx:{height:"100vh",display:"flex",flexDirection:"column"},children:[t.jsx(z,{position:"static",color:"default",elevation:1,children:t.jsxs(H,{children:[t.jsx(u,{startIcon:t.jsx(G,{}),onClick:()=>{var e;return h(`/t/${(e=r.tree)==null?void 0:e.treeId}`)},sx:{mr:2},children:"Back"}),t.jsxs(F,{variant:"h6",component:"div",sx:{flexGrow:0,mr:3},children:[s==="restore"?"Restore from Trash":"Empty Trash"," - ",(w=r.tree)==null?void 0:w.name]}),t.jsx(B,{direction:"row",spacing:2,sx:{flexGrow:1},children:s==="restore"?t.jsxs(u,{variant:"contained",color:"primary",startIcon:t.jsx(V,{}),onClick:x,disabled:n.length===0||p,children:["Restore Selected (",n.length,")"]}):t.jsxs(u,{variant:"contained",color:"error",startIcon:t.jsx(U,{}),onClick:I,disabled:((y=r.trashItems)==null?void 0:y.length)===0||p,children:["Empty All Trash (",((T=r.trashItems)==null?void 0:T.length)||0," items)"]})}),t.jsx(c,{sx:{ml:"auto"},children:t.jsx(_,{})})]})}),t.jsx(c,{sx:{flex:1,overflow:"hidden"},children:p?t.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:t.jsx(M,{})}):t.jsx($,{title:`Trash - ${(j=r.tree)==null?void 0:j.name}`,rootNodeId:(C=r.tree)==null?void 0:C.treeTrashRootNodeId,data:D,columns:S,breadcrumbItems:[{id:((v=r.tree)==null?void 0:v.treeTrashRootNodeId)||"",name:"Trash",nodeType:"Trash",isClickable:!1}],loading:!1,selectedIds:n,expandedIds:[],searchTerm:"",viewMode:"list",canCreate:!1,canEdit:!1,canDelete:s==="empty",onNodeClick:e=>console.log("Node clicked:",e),onNodeSelect:(e,o)=>{g(a=>o?[...a,e]:a.filter(l=>l!==e))},onNodeExpand:()=>{},availableFilters:[],onSearchChange:()=>{},onSearchClear:()=>{},onCreate:()=>{},onEdit:()=>{},onDelete:()=>{s==="empty"&&I()},onRefresh:()=>window.location.reload(),onExpandAll:()=>{},onCollapseAll:()=>{},onSort:()=>{},onFilterChange:()=>{},onViewModeChange:()=>{},onBreadcrumbNavigate:()=>{},onContextMenuAction:(e,o)=>{console.log("Context menu action:",e,"for node:",o),e==="restore"&&s==="restore"&&(g([o.id]),x())}})})]})});export{de as clientLoader,ce as default};
