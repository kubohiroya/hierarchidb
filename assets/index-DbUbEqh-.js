var _=Object.defineProperty;var j=(e,r,t)=>r in e?_(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var p=(e,r,t)=>j(e,typeof r!="symbol"?r+"":r,t);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const O=Symbol("Comlink.proxy"),F=Symbol("Comlink.endpoint"),G=Symbol("Comlink.releaseProxy"),A=Symbol("Comlink.finalizer"),k=Symbol("Comlink.thrown"),z=e=>typeof e=="object"&&e!==null||typeof e=="function",Y={canHandle:e=>z(e)&&e[O],serialize(e){const{port1:r,port2:t}=new MessageChannel;return N(e,r),[t,[t]]},deserialize(e){return e.start(),V(e)}},q={canHandle:e=>z(e)&&k in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},L=new Map([["proxy",Y],["throw",q]]);function X(e,r){for(const t of e)if(r===t||t==="*"||t instanceof RegExp&&t.test(r))return!0;return!1}function N(e,r=globalThis,t=["*"]){r.addEventListener("message",function y(n){if(!n||!n.data)return;if(!X(t,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:s,type:g,path:l}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(w);let o;try{const i=l.slice(0,-1).reduce((a,m)=>a[m],e),f=l.reduce((a,m)=>a[m],e);switch(g){case"GET":o=f;break;case"SET":i[l.slice(-1)[0]]=w(n.data.value),o=!0;break;case"APPLY":o=f.apply(i,u);break;case"CONSTRUCT":{const a=new f(...u);o=Z(a)}break;case"ENDPOINT":{const{port1:a,port2:m}=new MessageChannel;N(e,m),o=Q(a,[a])}break;case"RELEASE":o=void 0;break;default:return}}catch(i){o={value:i,[k]:0}}Promise.resolve(o).catch(i=>({value:i,[k]:0})).then(i=>{const[f,a]=x(i);r.postMessage(Object.assign(Object.assign({},f),{id:s}),a),g==="RELEASE"&&(r.removeEventListener("message",y),U(r),A in e&&typeof e[A]=="function"&&e[A]())}).catch(i=>{const[f,a]=x({value:new TypeError("Unserializable return value"),[k]:0});r.postMessage(Object.assign(Object.assign({},f),{id:s}),a)})}),r.start&&r.start()}function $(e){return e.constructor.name==="MessagePort"}function U(e){$(e)&&e.close()}function V(e,r){const t=new Map;return e.addEventListener("message",function(n){const{data:s}=n;if(!s||!s.id)return;const g=t.get(s.id);if(g)try{g(s)}finally{t.delete(s.id)}}),S(e,t,[],r)}function b(e){if(e)throw new Error("Proxy has been released and is not useable")}function H(e){return h(e,new Map,{type:"RELEASE"}).then(()=>{U(e)})}const P=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const r=(P.get(e)||0)-1;P.set(e,r),r===0&&H(e)});function B(e,r){const t=(P.get(r)||0)+1;P.set(r,t),E&&E.register(e,r,e)}function J(e){E&&E.unregister(e)}function S(e,r,t=[],y=function(){}){let n=!1;const s=new Proxy(y,{get(g,l){if(b(n),l===G)return()=>{J(s),H(e),r.clear(),n=!0};if(l==="then"){if(t.length===0)return{then:()=>s};const u=h(e,r,{type:"GET",path:t.map(o=>o.toString())}).then(w);return u.then.bind(u)}return S(e,r,[...t,l])},set(g,l,u){b(n);const[o,i]=x(u);return h(e,r,{type:"SET",path:[...t,l].map(f=>f.toString()),value:o},i).then(w)},apply(g,l,u){b(n);const o=t[t.length-1];if(o===F)return h(e,r,{type:"ENDPOINT"}).then(w);if(o==="bind")return S(e,r,t.slice(0,-1));const[i,f]=I(u);return h(e,r,{type:"APPLY",path:t.map(a=>a.toString()),argumentList:i},f).then(w)},construct(g,l){b(n);const[u,o]=I(l);return h(e,r,{type:"CONSTRUCT",path:t.map(i=>i.toString()),argumentList:u},o).then(w)}});return B(s,e),s}function K(e){return Array.prototype.concat.apply([],e)}function I(e){const r=e.map(x);return[r.map(t=>t[0]),K(r.map(t=>t[1]))]}const D=new WeakMap;function Q(e,r){return D.set(e,r),e}function Z(e){return Object.assign(e,{[O]:!0})}function x(e){for(const[r,t]of L)if(t.canHandle(e)){const[y,n]=t.serialize(e);return[{type:"HANDLER",name:r,value:y},n]}return[{type:"RAW",value:e},D.get(e)||[]]}function w(e){switch(e.type){case"HANDLER":return L.get(e.name).deserialize(e.value);case"RAW":return e.value}}function h(e,r,t,y){return new Promise(n=>{const s=ee();r.set(s,n),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),y)})}function ee(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var re={SuperRoot:"SuperRoot",Root:"Root",Trash:"Trash"},ie={...re},c,v,C,W;try{const e=typeof process<"u"?"production":void 0;c=e==="development"||e==="test"||typeof globalThis<"u"&&((W=(C=(v=globalThis==null?void 0:globalThis.import)==null?void 0:v.meta)==null?void 0:C.env)==null?void 0:W.DEV)||!1}catch{c=!1}var d=(...e)=>{},te=()=>{};c&&console.log.bind(console);c&&console.warn.bind(console);c&&console.info.bind(console);c&&console.debug.bind(console);c&&console.table.bind(console);c&&console.group.bind(console);c&&console.groupCollapsed.bind(console);c&&console.groupEnd.bind(console);c&&console.time.bind(console);c&&console.timeEnd.bind(console);c&&console.timeLog.bind(console);var T,ne=(T=class{static getSingleton(e,r){return!this.instances.has(e)&&r&&this.instances.set(e,r()),this.instances.get(e)}static terminate(e){this.instances.delete(e)}static terminateAll(){this.instances.clear()}},p(T,"instances",new Map),T),R;function ae(e){R=e}function oe(){if(typeof window>"u")throw new Error("Worker creation is not supported in non-browser environments");if(!R)throw new Error("Worker URL not configured. Please call setWorkerUrl() with the path to your built worker file.");return new Worker(R,{type:"module"})}var ce=class M{constructor(){p(this,"worker");p(this,"workerAPIProxy")}static async getSingleton(){return ne.getSingleton(M.name,async()=>{const r=new M;return r.worker=oe(),r.workerAPIProxy=V(r.worker),await r.workerAPIProxy.initialize(),r})}async ping(){if(!this.workerAPIProxy)return!1;try{return await this.workerAPIProxy.initialize(),!0}catch{return!1}}async cleanup(){if(this.workerAPIProxy)try{await this.workerAPIProxy.dispose()}catch(r){console.error("Error disposing worker proxy:",r)}this.worker&&(this.worker.terminate(),this.worker=void 0),this.workerAPIProxy=void 0}getAPI(){if(!this.workerAPIProxy)throw new Error("Worker not initialized");return this.workerAPIProxy}};export{ie as T,ce as W,ae as s};
