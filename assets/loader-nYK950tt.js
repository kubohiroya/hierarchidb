var j=Object.defineProperty;var G=(e,r,t)=>r in e?j(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var h=(e,r,t)=>G(e,typeof r!="symbol"?r+"":r,t);const B={SuperRoot:"SuperRoot",Root:"Root",Trash:"Trash"},M={...B};var R;(function(e){e.CREATE="create",e.UPDATE="update",e.DELETE="delete",e.MOVE="move",e.DUPLICATE="duplicate",e.IMPORT="import",e.EXPORT="export",e.RESTORE="restore",e.DISCARD="discard"})(R||(R={}));var x;(function(e){e.Asc="asc",e.Desc="desc"})(x||(x={}));class L{static getSingleton(r,t){return!this.instances.has(r)&&t&&this.instances.set(r,t()),this.instances.get(r)}static terminate(r){this.instances.delete(r)}static terminateAll(){this.instances.clear()}}h(L,"instances",new Map);let f;var O,V,C;try{const e=typeof process<"u"?"production":void 0;f=e==="development"||e==="test"||typeof globalThis<"u"&&((C=(V=(O=globalThis==null?void 0:globalThis.import)==null?void 0:O.meta)==null?void 0:V.env)==null?void 0:C.DEV)||!1}catch{f=!1}const p=(...e)=>{},X=()=>{};f&&console.log.bind(console);f&&console.warn.bind(console);f&&console.info.bind(console);f&&console.debug.bind(console);f&&console.table.bind(console);f&&console.group.bind(console);f&&console.groupCollapsed.bind(console);f&&console.groupEnd.bind(console);f&&console.time.bind(console);f&&console.timeEnd.bind(console);f&&console.timeLog.bind(console);/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const N=Symbol("Comlink.proxy"),q=Symbol("Comlink.endpoint"),Y=Symbol("Comlink.releaseProxy"),_=Symbol("Comlink.finalizer"),T=Symbol("Comlink.thrown"),D=e=>typeof e=="object"&&e!==null||typeof e=="function",K={canHandle:e=>D(e)&&e[N],serialize(e){const{port1:r,port2:t}=new MessageChannel;return H(e,r),[t,[t]]},deserialize(e){return e.start(),U(e)}},$={canHandle:e=>D(e)&&T in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},v=new Map([["proxy",K],["throw",$]]);function J(e,r){for(const t of e)if(r===t||t==="*"||t instanceof RegExp&&t.test(r))return!0;return!1}function H(e,r=globalThis,t=["*"]){r.addEventListener("message",function s(n){if(!n||!n.data)return;if(!J(t,n.origin)){console.warn(`Invalid origin '${n.origin}' for comlink proxy`);return}const{id:o,type:g,path:c}=Object.assign({path:[]},n.data),u=(n.data.argumentList||[]).map(P);let a;try{const i=c.slice(0,-1).reduce((l,w)=>l[w],e),d=c.reduce((l,w)=>l[w],e);switch(g){case"GET":a=d;break;case"SET":i[c.slice(-1)[0]]=P(n.data.value),a=!0;break;case"APPLY":a=d.apply(i,u);break;case"CONSTRUCT":{const l=new d(...u);a=ne(l)}break;case"ENDPOINT":{const{port1:l,port2:w}=new MessageChannel;H(e,w),a=te(l,[l])}break;case"RELEASE":a=void 0;break;default:return}}catch(i){a={value:i,[T]:0}}Promise.resolve(a).catch(i=>({value:i,[T]:0})).then(i=>{const[d,l]=I(i);r.postMessage(Object.assign(Object.assign({},d),{id:o}),l),g==="RELEASE"&&(r.removeEventListener("message",s),z(r),_ in e&&typeof e[_]=="function"&&e[_]())}).catch(i=>{const[d,l]=I({value:new TypeError("Unserializable return value"),[T]:0});r.postMessage(Object.assign(Object.assign({},d),{id:o}),l)})}),r.start&&r.start()}function Q(e){return e.constructor.name==="MessagePort"}function z(e){Q(e)&&e.close()}function U(e,r){const t=new Map;return e.addEventListener("message",function(n){const{data:o}=n;if(!o||!o.id)return;const g=t.get(o.id);if(g)try{g(o)}finally{t.delete(o.id)}}),k(e,t,[],r)}function y(e){if(e)throw new Error("Proxy has been released and is not useable")}function F(e){return E(e,new Map,{type:"RELEASE"}).then(()=>{z(e)})}const m=new WeakMap,A="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const r=(m.get(e)||0)-1;m.set(e,r),r===0&&F(e)});function Z(e,r){const t=(m.get(r)||0)+1;m.set(r,t),A&&A.register(e,r,e)}function ee(e){A&&A.unregister(e)}function k(e,r,t=[],s=function(){}){let n=!1;const o=new Proxy(s,{get(g,c){if(y(n),c===Y)return()=>{ee(o),F(e),r.clear(),n=!0};if(c==="then"){if(t.length===0)return{then:()=>o};const u=E(e,r,{type:"GET",path:t.map(a=>a.toString())}).then(P);return u.then.bind(u)}return k(e,r,[...t,c])},set(g,c,u){y(n);const[a,i]=I(u);return E(e,r,{type:"SET",path:[...t,c].map(d=>d.toString()),value:a},i).then(P)},apply(g,c,u){y(n);const a=t[t.length-1];if(a===q)return E(e,r,{type:"ENDPOINT"}).then(P);if(a==="bind")return k(e,r,t.slice(0,-1));const[i,d]=S(u);return E(e,r,{type:"APPLY",path:t.map(l=>l.toString()),argumentList:i},d).then(P)},construct(g,c){y(n);const[u,a]=S(c);return E(e,r,{type:"CONSTRUCT",path:t.map(i=>i.toString()),argumentList:u},a).then(P)}});return Z(o,e),o}function re(e){return Array.prototype.concat.apply([],e)}function S(e){const r=e.map(I);return[r.map(t=>t[0]),re(r.map(t=>t[1]))]}const W=new WeakMap;function te(e,r){return W.set(e,r),e}function ne(e){return Object.assign(e,{[N]:!0})}function I(e){for(const[r,t]of v)if(t.canHandle(e)){const[s,n]=t.serialize(e);return[{type:"HANDLER",name:r,value:s},n]}return[{type:"RAW",value:e},W.get(e)||[]]}function P(e){switch(e.type){case"HANDLER":return v.get(e.name).deserialize(e.value);case"RAW":return e.value}}function E(e,r,t,s){return new Promise(n=>{const o=oe();r.set(o,n),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),s)})}function oe(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}class b{constructor(){h(this,"worker");h(this,"workerAPIProxy")}static async getSingleton(){return L.getSingleton(b.name,async()=>{const r=new b;return r.worker=new Worker(new URL("/hierarchidb/worker.js",import.meta.url),{type:"module"}),r.workerAPIProxy=U(r.worker),await r.workerAPIProxy.initialize(),r})}async ping(){if(!this.workerAPIProxy)return!1;try{return await this.workerAPIProxy.initialize(),!0}catch{return!1}}async cleanup(){if(this.workerAPIProxy)try{await this.workerAPIProxy.dispose()}catch(r){console.error("Error disposing worker proxy:",r)}this.worker&&(this.worker.terminate(),this.worker=void 0),this.workerAPIProxy=void 0}getAPI(){if(!this.workerAPIProxy)throw new Error("Worker not initialized");return this.workerAPIProxy}}const ae={VITE_APP_ATTRIBUTION:"Hiroya Kubo",VITE_APP_DESCRIPTION:"High-performance tree-structured data management framework for browser environments",VITE_APP_DETAILS:"A powerful framework for managing hierarchical data in browser environments",VITE_APP_FAVICON:"favicon.svg",VITE_APP_LOCALE:"en-US",VITE_APP_LOGO:"logo.png",VITE_APP_NAME:"hierarchidb",VITE_APP_PREFIX:"hierarchidb",VITE_APP_THEME:"light",VITE_APP_TITLE:"HierarchiDB"};function se(){const{VITE_APP_PREFIX:e,VITE_APP_NAME:r,VITE_APP_TITLE:t,VITE_APP_DESCRIPTION:s,APP_HOMEPAGE:n,VITE_APP_LOGO:o,VITE_APP_FAVICON:g,VITE_APP_THEME:c,VITE_APP_LOCALE:u,VITE_APP_ATTRIBUTION:a,VITE_APP_DETAILS:i}=ae;return{appPrefix:e||"",appName:r||"HierarchiDB",appTitle:t||"HierarchiDB",appDescription:s||"High-performance tree-structured data management framework for browser environments",appDetails:i||"A powerful framework for managing hierarchical data in browser environments",appHomepage:n||"https://github.com/kubohiroya/hierarchidb",appLogo:o||"logo.png",appFavicon:g||"logo.favicon.png",appTheme:c||"light",appLocale:u||"en-US",appAttribution:a||"",appDefaultLocale:"en-US",appDefaultLanguage:"en"}}async function ie(){return{...await se(),client:await b.getSingleton()}}async function ce({treeId:e}){const r=await ie();if(!e)throw new Error("treeId is required");return{client:r.client,tree:await r.client.getAPI().getTree({treeId:e})}}async function le({treeId:e,pageTreeNodeId:r}){const t=await ce({treeId:e});return{...t,pageTreeNode:await t.client.getAPI().getNode({treeNodeId:r||e+M.Root})}}async function ue({treeId:e,pageTreeNodeId:r,targetTreeNodeId:t}){const s=await le({treeId:e,pageTreeNodeId:r});return{...s,targetTreeNode:await s.client.getAPI().getNode({treeNodeId:t||r||e+M.Root})}}async function fe({treeId:e,pageTreeNodeId:r,targetTreeNodeId:t,treeNodeType:s}){return{...await ue({treeId:e,pageTreeNodeId:r,targetTreeNodeId:t}),treeNodeType:s}}async function de({treeId:e,pageTreeNodeId:r,targetTreeNodeId:t,treeNodeType:s,action:n}){return{...await fe({treeId:e,pageTreeNodeId:r,targetTreeNodeId:t,treeNodeType:s}),action:n}}export{le as a,ue as b,fe as c,de as d,ie as e,se as f,ce as l};
