import{r as g,w as ue,e as ge,u as fe,b as me}from"./vendor-react-BP9jdMJE.js";import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{T as ve}from"./index-CyZumM2T.js";import{b as be}from"./loader-Ccba733m.js";import{T as ee,W as oe}from"./index-DbUbEqh-.js";import{c as Ce,a as ye}from"./treeNodeConverter-aJJwZjp1.js";import{D as $e,a as Ie,C as xe,b as he}from"./Close-Cym2ai9q.js";import{c as ne,u as Te,a as ae,B as te,T as _}from"./Box-zDrc8-aq.js";import{c as E}from"./assertThisInitialized-C6AqJUPC.js";import{d as se,g as ie,u as ce,s as Z,c,a as de,m as ke,f as W}from"./createSimplePaletteValueFilter-BuD9q6B8.js";import{u as re}from"./useSlot-Cr8mcnhD.js";import{I as Se}from"./IconButton-DRvuffCM.js";import{L as Ne}from"./LinearProgress-DoQqdAc9.js";import{A as X}from"./Alert-C-Br81AU.js";import{B as U}from"./Button-SDpdNXaB.js";import{R as Re}from"./RestoreFromTrash-C4zCvTlp.js";import"./useThemeWithoutDefault-B_xv69Jx.js";import"./TransitionGroup-wYxCXXF3.js";import"./Paper-hI1Q5KHP.js";const we=ne(s.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function De(e){return ie("MuiChip",e)}const l=se("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Pe=e=>{const{classes:o,disabled:a,size:t,color:p,iconColor:b,onDelete:r,clickable:i,variant:m}=e,y={root:["root",m,a&&"disabled",`size${c(t)}`,`color${c(p)}`,i&&"clickable",i&&`clickableColor${c(p)}`,r&&"deletable",r&&`deletableColor${c(p)}`,`${m}${c(p)}`],label:["label",`label${c(t)}`],avatar:["avatar",`avatar${c(t)}`,`avatarColor${c(p)}`],icon:["icon",`icon${c(t)}`,`iconColor${c(b)}`],deleteIcon:["deleteIcon",`deleteIcon${c(t)}`,`deleteIconColor${c(p)}`,`deleteIcon${c(m)}Color${c(p)}`]};return de(y,De,o)},je=Z("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:a}=e,{color:t,iconColor:p,clickable:b,onDelete:r,size:i,variant:m}=a;return[{[`& .${l.avatar}`]:o.avatar},{[`& .${l.avatar}`]:o[`avatar${c(i)}`]},{[`& .${l.avatar}`]:o[`avatarColor${c(t)}`]},{[`& .${l.icon}`]:o.icon},{[`& .${l.icon}`]:o[`icon${c(i)}`]},{[`& .${l.icon}`]:o[`iconColor${c(p)}`]},{[`& .${l.deleteIcon}`]:o.deleteIcon},{[`& .${l.deleteIcon}`]:o[`deleteIcon${c(i)}`]},{[`& .${l.deleteIcon}`]:o[`deleteIconColor${c(t)}`]},{[`& .${l.deleteIcon}`]:o[`deleteIcon${c(m)}Color${c(t)}`]},o.root,o[`size${c(i)}`],o[`color${c(t)}`],b&&o.clickable,b&&t!=="default"&&o[`clickableColor${c(t)})`],r&&o.deletable,r&&t!=="default"&&o[`deletableColor${c(t)}`],o[m],o[`${m}${c(t)}`]]}})(ke(({theme:e})=>{const o=e.palette.mode==="light"?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${l.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${l.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:o,fontSize:e.typography.pxToRem(12)},[`& .${l.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${l.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${l.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${l.icon}`]:{marginLeft:5,marginRight:-6},[`& .${l.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${l.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${l.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter(W(["contrastText"])).map(([a])=>({props:{color:a},style:{backgroundColor:(e.vars||e).palette[a].main,color:(e.vars||e).palette[a].contrastText,[`& .${l.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[a].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[a].contrastText}}}})),{props:a=>a.iconColor===a.color,style:{[`& .${l.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:o}}},{props:a=>a.iconColor===a.color&&a.color!=="default",style:{[`& .${l.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter(W(["dark"])).map(([a])=>({props:{color:a,onDelete:!0},style:{[`&.${l.focusVisible}`]:{background:(e.vars||e).palette[a].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter(W(["dark"])).map(([a])=>({props:{color:a,clickable:!0},style:{[`&:hover, &.${l.focusVisible}`]:{backgroundColor:(e.vars||e).palette[a].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${l.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${l.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${l.avatar}`]:{marginLeft:4},[`& .${l.avatarSmall}`]:{marginLeft:2},[`& .${l.icon}`]:{marginLeft:4},[`& .${l.iconSmall}`]:{marginLeft:2},[`& .${l.deleteIcon}`]:{marginRight:5},[`& .${l.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter(W()).map(([a])=>({props:{variant:"outlined",color:a},style:{color:(e.vars||e).palette[a].main,border:`1px solid ${e.alpha((e.vars||e).palette[a].main,.7)}`,[`&.${l.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[a].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[a].main,(e.vars||e).palette.action.focusOpacity)},[`& .${l.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[a].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[a].main}}}}))]}})),Ae=Z("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,o)=>{const{ownerState:a}=e,{size:t}=a;return[o.label,o[`label${c(t)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function le(e){return e.key==="Backspace"||e.key==="Delete"}const ze=g.forwardRef(function(o,a){const t=ce({props:o,name:"MuiChip"}),{avatar:p,className:b,clickable:r,color:i="default",component:m,deleteIcon:y,disabled:$=!1,icon:f,label:D,onClick:h,onDelete:u,onKeyDown:F,onKeyUp:j,size:I="medium",variant:R="filled",tabIndex:P,skipFocusWhenDisabled:w=!1,slots:K={},slotProps:G={},...H}=t,Y=g.useRef(null),q=Te(Y,a),B=d=>{d.stopPropagation(),u&&u(d)},A=d=>{d.currentTarget===d.target&&le(d)&&d.preventDefault(),F&&F(d)},x=d=>{d.currentTarget===d.target&&u&&le(d)&&u(d),j&&j(d)},z=r!==!1&&h?!0:r,L=z||u?ae:m||"div",M={...t,component:L,disabled:$,size:I,color:i,iconColor:g.isValidElement(f)&&f.props.color||i,onDelete:!!u,clickable:z,variant:R},T=Pe(M),O=L===ae?{component:m||"div",focusVisibleClassName:T.focusVisible,...u&&{disableRipple:!0}}:{};let n=null;u&&(n=y&&g.isValidElement(y)?g.cloneElement(y,{className:E(y.props.className,T.deleteIcon),onClick:B}):s.jsx(we,{className:T.deleteIcon,onClick:B}));let C=null;p&&g.isValidElement(p)&&(C=g.cloneElement(p,{className:E(T.avatar,p.props.className)}));let v=null;f&&g.isValidElement(f)&&(v=g.cloneElement(f,{className:E(T.icon,f.props.className)}));const k={slots:K,slotProps:G},[J,V]=re("root",{elementType:je,externalForwardedProps:{...k,...H},ownerState:M,shouldForwardComponentProp:!0,ref:q,className:E(T.root,b),additionalProps:{disabled:z&&$?!0:void 0,tabIndex:w&&$?-1:P,...O},getSlotProps:d=>({...d,onClick:S=>{var N;(N=d.onClick)==null||N.call(d,S),h==null||h(S)},onKeyDown:S=>{var N;(N=d.onKeyDown)==null||N.call(d,S),A==null||A(S)},onKeyUp:S=>{var N;(N=d.onKeyUp)==null||N.call(d,S),x==null||x(S)}})}),[Q,pe]=re("label",{elementType:Ae,externalForwardedProps:k,ownerState:M,className:T.label});return s.jsxs(J,{as:L,...V,children:[C||v,s.jsx(Q,{...pe,children:D}),n]})});function Le(e){return ie("MuiDialogActions",e)}se("MuiDialogActions",["root","spacing"]);const Me=e=>{const{classes:o,disableSpacing:a}=e;return de({root:["root",!a&&"spacing"]},Le,o)},Ee=Z("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:a}=e;return[o.root,!a.disableSpacing&&o.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:e})=>!e.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Fe=g.forwardRef(function(o,a){const t=ce({props:o,name:"MuiDialogActions"}),{className:p,disableSpacing:b=!1,...r}=t,i={...t,disableSpacing:b},m=Me(i);return s.jsx(Ee,{className:E(m.root,p),ownerState:i,ref:a,...r})}),Be=ne(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));async function lo(e){const o=e.params,a=o.pageTreeNodeId||o.treeId+ee.Root,t=a==="undefined"?o.treeId+ee.Root:a,p=await be({...o,pageTreeNodeId:t}),r=p.client.getAPI(),i=p.tree;let m,y=[];if(i){m=i.treeTrashRootNodeId;const $=o.targetTreeNodeId==="trash"?m:o.targetTreeNodeId;if($)try{y=await r.getChildren({parentTreeNodeId:$})}catch(f){console.error("Failed to load trash items:",f)}}return{...p,trashRootId:m,trashItems:y,treeNodeType:o.treeNodeType}}const no=ue(function(){var O;const{treeId:o,pageTreeNodeId:a,targetTreeNodeId:t,treeNodeType:p}=ge(),b=fe(),r=me(),[i,m]=g.useState([]),[y,$]=g.useState([]),[f,D]=g.useState(!1),[h,u]=g.useState(null),[F,j]=g.useState(""),I=p,R=I==="recover",P=I==="delete",w=()=>{b(`/t/${o}/${a}`)},K=async()=>{if(i.length===0){u("Please select items to restore");return}if(!(i.length>1&&!confirm(`Are you sure you want to restore ${i.length} items from the trash?`))){D(!0),u(null);try{const v=await(await oe.getSingleton()).getAPI().recoverFromTrash({payload:{nodeIds:i},commandId:`recover-${Date.now()}`,groupId:`group-${Date.now()}`,kind:"recoverFromTrash",issuedAt:Date.now()});v.success?(u(null),setTimeout(()=>{w(),window.location.reload()},500)):u(`Failed to restore items: ${v.error||"Unknown error"}`)}catch(n){u(n instanceof Error?n.message:"An error occurred")}finally{D(!1)}}},G=async()=>{if(!r.trashItems||r.trashItems.length===0){u("No items to delete");return}const C=`Are you sure you want to permanently remove all ${r.trashItems.length} items from the trash?

⚠️ This action cannot be undone and all selected items will be permanently deleted.`;if(confirm(C)){D(!0),u(null);try{const k=(await oe.getSingleton()).getAPI(),J=r.trashItems.map(Q=>Q.treeNodeId),V=await k.remove({payload:{nodeIds:J},commandId:`delete-${Date.now()}`,groupId:`group-${Date.now()}`,kind:"remove",issuedAt:Date.now()});V.success?(u(null),setTimeout(()=>{w(),window.location.reload()},500)):u(`Failed to remove items: ${V.error||"Unknown error"}`)}catch(v){u(v instanceof Error?v.message:"An error occurred")}finally{D(!1)}}},H=g.useCallback(n=>{b(`/t/${o}/${a}/${n.id}/${I}`)},[b,o,a,I]),Y=g.useCallback(n=>{n.id==="trash"||n.id===r.trashRootId?b(`/t/${o}/${a}/trash/${I}`):b(`/t/${o}/${a}/${n.id}/${I}`)},[b,o,a,I,r.trashRootId]),q=g.useCallback(()=>{t!=="trash"&&t!==r.trashRootId&&b(`/t/${o}/${a}/trash/${I}`)},[b,o,a,t,r.trashRootId,I]),B=g.useCallback((n,C)=>{m(C?v=>[...v,n]:v=>v.filter(k=>k!==n))},[]),A=g.useCallback((n,C)=>{$(C?v=>[...v,n]:v=>v.filter(k=>k!==n))},[]),x=((O=r.trashItems)==null?void 0:O.map(Ce))||[],z=ye(),L=g.useMemo(()=>{const n=[{id:"trash",name:"Trash",nodeType:"folder",isClickable:!0}];return t!=="trash"&&t!==r.trashRootId&&r.targetTreeNode&&n.push({id:r.targetTreeNode.treeNodeId,name:r.targetTreeNode.name,nodeType:r.targetTreeNode.treeNodeType,isClickable:!1}),n},[t,r.trashRootId,r.targetTreeNode]),M=()=>{const n=R?"Restore from Trash":P?"Empty Trash":"Trash";return t!=="trash"&&t!==r.trashRootId&&r.targetTreeNode?`${n} - ${r.targetTreeNode.name}`:n},T=()=>{var n;if(R){const C=f?`Restoring ${i.length} items...`:`Restore Selected (${i.length})`;return s.jsx(U,{variant:"contained",color:"primary",startIcon:s.jsx(Re,{}),onClick:K,disabled:i.length===0||f,sx:{minWidth:180},children:C})}else if(P){const C=((n=r.trashItems)==null?void 0:n.length)||0,v=f?`Removing ${C} items...`:`Remove All (${C} items)`;return s.jsx(U,{variant:"contained",color:"error",startIcon:s.jsx(Be,{}),onClick:G,disabled:C===0||f,sx:{minWidth:180},children:v})}return null};return s.jsxs($e,{open:!0,fullWidth:!0,maxWidth:"lg",onClose:w,PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[s.jsxs(Ie,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsxs(te,{sx:{flexGrow:1},children:[s.jsxs(te,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(_,{variant:"h6",children:M()}),x.length>0&&s.jsx(ze,{label:`${x.length} items`,size:"small",variant:"outlined",color:P?"error":"primary"})]}),t!=="trash"&&t!==r.trashRootId&&r.targetTreeNode&&s.jsxs(_,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["📁 ",r.targetTreeNode.name]}),(t==="trash"||t===r.trashRootId)&&x.length===0&&s.jsx(_,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"🗑️ Trash is empty"})]}),s.jsx(Se,{onClick:w,size:"small",disabled:f,children:s.jsx(xe,{})})]}),f&&s.jsx(Ne,{}),s.jsxs(he,{sx:{flex:1,overflow:"hidden",p:0},children:[h&&s.jsx(X,{severity:"error",onClose:()=>u(null),sx:{m:2},action:s.jsx(U,{size:"small",color:"inherit",onClick:()=>u(null),children:"Dismiss"}),children:h}),!f&&!h&&x.length===0&&s.jsx(X,{severity:"info",sx:{m:2},children:t==="trash"||t===r.trashRootId?"🗑️ The trash is empty. Deleted items will appear here.":"📁 This folder is empty."}),P&&s.jsx(X,{severity:"warning",sx:{m:2},children:"⚠️ You are about to remove all items from the trash. This action cannot be undone."}),s.jsx(ve,{title:"Trash Items",rootNodeId:r.trashRootId||"trash",data:x,columns:z,breadcrumbItems:L,loading:f,error:h||void 0,selectedIds:R?i:[],expandedIds:y,searchTerm:F,viewMode:"list",canCreate:!1,canEdit:!1,canDelete:!1,showNavigationButtons:!1,dense:!0,availableFilters:[],onNodeClick:H,onNodeSelect:R&&!f?B:void 0,onNodeExpand:A,onSearchChange:j,onSearchClear:()=>j(""),onCreate:()=>{},onEdit:()=>{},onDelete:()=>{},onRefresh:()=>window.location.reload(),onExpandAll:()=>$(x.map(n=>n.id)),onCollapseAll:()=>$([]),onSort:()=>{},onFilterChange:()=>{},onViewModeChange:()=>{},onBreadcrumbNavigate:Y,onNavigateBack:q,onNavigateForward:()=>{},canGoBack:t!=="trash"&&t!==r.trashRootId,canGoForward:!1,onContextMenuAction:()=>{}})]}),s.jsxs(Fe,{sx:{px:3,py:2,gap:1},children:[s.jsx(U,{onClick:w,color:"inherit",disabled:f,children:"Cancel"}),T(),R&&i.length>0&&!f&&s.jsxs(_,{variant:"caption",color:"text.secondary",sx:{ml:2},children:[i.length," item",i.length!==1?"s":""," selected"]})]})]})});export{lo as clientLoader,no as default};
