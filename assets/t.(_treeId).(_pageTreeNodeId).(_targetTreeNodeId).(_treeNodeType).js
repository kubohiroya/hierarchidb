import{r as u,w as pe,e as ue,u as ge,b as fe}from"./vendor-react-BP9jdMJE.js";import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{T as me}from"./index-CyZumM2T.js";import{b as ve}from"./loader-D5if6doL.js";import{W as ee}from"./index-SzJX3EJy.js";import{c as be,a as Ce}from"./treeNodeConverter-aJJwZjp1.js";import{D as ye,a as $e,C as xe,b as Ie}from"./Close-Cym2ai9q.js";import{c as le,u as he,a as oe,B as ae,T as _}from"./Box-zDrc8-aq.js";import{c as E}from"./assertThisInitialized-C6AqJUPC.js";import{d as ne,g as se,u as ie,s as Z,c,a as ce,m as Te,f as W}from"./createSimplePaletteValueFilter-BuD9q6B8.js";import{u as te}from"./useSlot-Cr8mcnhD.js";import{I as ke}from"./IconButton-DRvuffCM.js";import{L as Se}from"./LinearProgress-DoQqdAc9.js";import{A as X}from"./Alert-C-Br81AU.js";import{B as U}from"./Button-SDpdNXaB.js";import{R as we}from"./RestoreFromTrash-C4zCvTlp.js";import"./useThemeWithoutDefault-B_xv69Jx.js";import"./TransitionGroup-wYxCXXF3.js";import"./Paper-hI1Q5KHP.js";const Re=le(s.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}));function Ne(e){return se("MuiChip",e)}const l=ne("MuiChip",["root","sizeSmall","sizeMedium","colorDefault","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),De=e=>{const{classes:a,disabled:o,size:t,color:g,iconColor:f,onDelete:r,clickable:i,variant:v}=e,$={root:["root",v,o&&"disabled",`size${c(t)}`,`color${c(g)}`,i&&"clickable",i&&`clickableColor${c(g)}`,r&&"deletable",r&&`deletableColor${c(g)}`,`${v}${c(g)}`],label:["label",`label${c(t)}`],avatar:["avatar",`avatar${c(t)}`,`avatarColor${c(g)}`],icon:["icon",`icon${c(t)}`,`iconColor${c(f)}`],deleteIcon:["deleteIcon",`deleteIcon${c(t)}`,`deleteIconColor${c(g)}`,`deleteIcon${c(v)}Color${c(g)}`]};return ce($,Ne,a)},Pe=Z("div",{name:"MuiChip",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e,{color:t,iconColor:g,clickable:f,onDelete:r,size:i,variant:v}=o;return[{[`& .${l.avatar}`]:a.avatar},{[`& .${l.avatar}`]:a[`avatar${c(i)}`]},{[`& .${l.avatar}`]:a[`avatarColor${c(t)}`]},{[`& .${l.icon}`]:a.icon},{[`& .${l.icon}`]:a[`icon${c(i)}`]},{[`& .${l.icon}`]:a[`iconColor${c(g)}`]},{[`& .${l.deleteIcon}`]:a.deleteIcon},{[`& .${l.deleteIcon}`]:a[`deleteIcon${c(i)}`]},{[`& .${l.deleteIcon}`]:a[`deleteIconColor${c(t)}`]},{[`& .${l.deleteIcon}`]:a[`deleteIcon${c(v)}Color${c(t)}`]},a.root,a[`size${c(i)}`],a[`color${c(t)}`],f&&a.clickable,f&&t!=="default"&&a[`clickableColor${c(t)})`],r&&a.deletable,r&&t!=="default"&&a[`deletableColor${c(t)}`],a[v],a[`${v}${c(t)}`]]}})(Te(({theme:e})=>{const a=e.palette.mode==="light"?e.palette.grey[700]:e.palette.grey[300];return{maxWidth:"100%",fontFamily:e.typography.fontFamily,fontSize:e.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,lineHeight:1.5,color:(e.vars||e).palette.text.primary,backgroundColor:(e.vars||e).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:e.transitions.create(["background-color","box-shadow"]),cursor:"unset",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${l.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${l.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:e.vars?e.vars.palette.Chip.defaultAvatarColor:a,fontSize:e.typography.pxToRem(12)},[`& .${l.avatarColorPrimary}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.dark},[`& .${l.avatarColorSecondary}`]:{color:(e.vars||e).palette.secondary.contrastText,backgroundColor:(e.vars||e).palette.secondary.dark},[`& .${l.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:e.typography.pxToRem(10)},[`& .${l.icon}`]:{marginLeft:5,marginRight:-6},[`& .${l.deleteIcon}`]:{WebkitTapHighlightColor:"transparent",color:e.alpha((e.vars||e).palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:e.alpha((e.vars||e).palette.text.primary,.4)}},variants:[{props:{size:"small"},style:{height:24,[`& .${l.icon}`]:{fontSize:18,marginLeft:4,marginRight:-4},[`& .${l.deleteIcon}`]:{fontSize:16,marginRight:4,marginLeft:-4}}},...Object.entries(e.palette).filter(W(["contrastText"])).map(([o])=>({props:{color:o},style:{backgroundColor:(e.vars||e).palette[o].main,color:(e.vars||e).palette[o].contrastText,[`& .${l.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].contrastText,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].contrastText}}}})),{props:o=>o.iconColor===o.color,style:{[`& .${l.icon}`]:{color:e.vars?e.vars.palette.Chip.defaultIconColor:a}}},{props:o=>o.iconColor===o.color&&o.color!=="default",style:{[`& .${l.icon}`]:{color:"inherit"}}},{props:{onDelete:!0},style:{[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)}}},...Object.entries(e.palette).filter(W(["dark"])).map(([o])=>({props:{color:o,onDelete:!0},style:{[`&.${l.focusVisible}`]:{background:(e.vars||e).palette[o].dark}}})),{props:{clickable:!0},style:{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)},[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette.action.selected,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.focusOpacity}`)},"&:active":{boxShadow:(e.vars||e).shadows[1]}}},...Object.entries(e.palette).filter(W(["dark"])).map(([o])=>({props:{color:o,clickable:!0},style:{[`&:hover, &.${l.focusVisible}`]:{backgroundColor:(e.vars||e).palette[o].dark}}})),{props:{variant:"outlined"},style:{backgroundColor:"transparent",border:e.vars?`1px solid ${e.vars.palette.Chip.defaultBorder}`:`1px solid ${e.palette.mode==="light"?e.palette.grey[400]:e.palette.grey[700]}`,[`&.${l.clickable}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${l.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`& .${l.avatar}`]:{marginLeft:4},[`& .${l.avatarSmall}`]:{marginLeft:2},[`& .${l.icon}`]:{marginLeft:4},[`& .${l.iconSmall}`]:{marginLeft:2},[`& .${l.deleteIcon}`]:{marginRight:5},[`& .${l.deleteIconSmall}`]:{marginRight:3}}},...Object.entries(e.palette).filter(W()).map(([o])=>({props:{variant:"outlined",color:o},style:{color:(e.vars||e).palette[o].main,border:`1px solid ${e.alpha((e.vars||e).palette[o].main,.7)}`,[`&.${l.clickable}:hover`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.hoverOpacity)},[`&.${l.focusVisible}`]:{backgroundColor:e.alpha((e.vars||e).palette[o].main,(e.vars||e).palette.action.focusOpacity)},[`& .${l.deleteIcon}`]:{color:e.alpha((e.vars||e).palette[o].main,.7),"&:hover, &:active":{color:(e.vars||e).palette[o].main}}}}))]}})),je=Z("span",{name:"MuiChip",slot:"Label",overridesResolver:(e,a)=>{const{ownerState:o}=e,{size:t}=o;return[a.label,a[`label${c(t)}`]]}})({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap",variants:[{props:{variant:"outlined"},style:{paddingLeft:11,paddingRight:11}},{props:{size:"small"},style:{paddingLeft:8,paddingRight:8}},{props:{size:"small",variant:"outlined"},style:{paddingLeft:7,paddingRight:7}}]});function re(e){return e.key==="Backspace"||e.key==="Delete"}const Ae=u.forwardRef(function(a,o){const t=ie({props:a,name:"MuiChip"}),{avatar:g,className:f,clickable:r,color:i="default",component:v,deleteIcon:$,disabled:T=!1,icon:b,label:D,onClick:I,onDelete:p,onKeyDown:F,onKeyUp:j,size:y="medium",variant:R="filled",tabIndex:P,skipFocusWhenDisabled:N=!1,slots:K={},slotProps:G={},...H}=t,Y=u.useRef(null),q=he(Y,o),B=d=>{d.stopPropagation(),p&&p(d)},A=d=>{d.currentTarget===d.target&&re(d)&&d.preventDefault(),F&&F(d)},x=d=>{d.currentTarget===d.target&&p&&re(d)&&p(d),j&&j(d)},z=r!==!1&&I?!0:r,L=z||p?oe:v||"div",M={...t,component:L,disabled:T,size:y,color:i,iconColor:u.isValidElement(b)&&b.props.color||i,onDelete:!!p,clickable:z,variant:R},h=De(M),O=L===oe?{component:v||"div",focusVisibleClassName:h.focusVisible,...p&&{disableRipple:!0}}:{};let n=null;p&&(n=$&&u.isValidElement($)?u.cloneElement($,{className:E($.props.className,h.deleteIcon),onClick:B}):s.jsx(Re,{className:h.deleteIcon,onClick:B}));let C=null;g&&u.isValidElement(g)&&(C=u.cloneElement(g,{className:E(h.avatar,g.props.className)}));let m=null;b&&u.isValidElement(b)&&(m=u.cloneElement(b,{className:E(h.icon,b.props.className)}));const k={slots:K,slotProps:G},[J,V]=te("root",{elementType:Pe,externalForwardedProps:{...k,...H},ownerState:M,shouldForwardComponentProp:!0,ref:q,className:E(h.root,f),additionalProps:{disabled:z&&T?!0:void 0,tabIndex:N&&T?-1:P,...O},getSlotProps:d=>({...d,onClick:S=>{var w;(w=d.onClick)==null||w.call(d,S),I==null||I(S)},onKeyDown:S=>{var w;(w=d.onKeyDown)==null||w.call(d,S),A==null||A(S)},onKeyUp:S=>{var w;(w=d.onKeyUp)==null||w.call(d,S),x==null||x(S)}})}),[Q,de]=te("label",{elementType:je,externalForwardedProps:k,ownerState:M,className:h.label});return s.jsxs(J,{as:L,...V,children:[C||m,s.jsx(Q,{...de,children:D}),n]})});function ze(e){return se("MuiDialogActions",e)}ne("MuiDialogActions",["root","spacing"]);const Le=e=>{const{classes:a,disableSpacing:o}=e;return ce({root:["root",!o&&"spacing"]},ze,a)},Me=Z("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:o}=e;return[a.root,!o.disableSpacing&&a.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:e})=>!e.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Ee=u.forwardRef(function(a,o){const t=ie({props:a,name:"MuiDialogActions"}),{className:g,disableSpacing:f=!1,...r}=t,i={...t,disableSpacing:f},v=Le(i);return s.jsx(Me,{className:E(v.root,g),ownerState:i,ref:o,...r})}),Fe=le(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}));async function ro(e){const a=e.params,o=await ve(a),g=o.client.getAPI(),f=o.tree;let r,i=[];if(f){r=f.treeTrashRootNodeId;const v=a.targetTreeNodeId==="trash"?r:a.targetTreeNodeId;if(v)try{i=await g.getChildren({parentTreeNodeId:v})}catch($){console.error("Failed to load trash items:",$)}}return{...o,trashRootId:r,trashItems:i,treeNodeType:a.treeNodeType}}const lo=pe(function(){var O;const{treeId:a,pageTreeNodeId:o,targetTreeNodeId:t,treeNodeType:g}=ue(),f=ge(),r=fe(),[i,v]=u.useState([]),[$,T]=u.useState([]),[b,D]=u.useState(!1),[I,p]=u.useState(null),[F,j]=u.useState(""),y=g,R=y==="recover",P=y==="delete",N=()=>{f(`/t/${a}/${o}`)},K=async()=>{if(i.length===0){p("Please select items to restore");return}if(!(i.length>1&&!confirm(`Are you sure you want to restore ${i.length} items from the trash?`))){D(!0),p(null);try{const m=await(await ee.getSingleton()).getAPI().recoverFromTrash({payload:{nodeIds:i},commandId:`recover-${Date.now()}`,groupId:`group-${Date.now()}`,kind:"recoverFromTrash",issuedAt:Date.now()});m.success?(p(null),setTimeout(()=>{N(),window.location.reload()},500)):p(`Failed to restore items: ${m.error||"Unknown error"}`)}catch(n){p(n instanceof Error?n.message:"An error occurred")}finally{D(!1)}}},G=async()=>{if(!r.trashItems||r.trashItems.length===0){p("No items to delete");return}const C=`Are you sure you want to permanently remove all ${r.trashItems.length} items from the trash?

⚠️ This action cannot be undone and all selected items will be permanently deleted.`;if(confirm(C)){D(!0),p(null);try{const k=(await ee.getSingleton()).getAPI(),J=r.trashItems.map(Q=>Q.treeNodeId),V=await k.remove({payload:{nodeIds:J},commandId:`delete-${Date.now()}`,groupId:`group-${Date.now()}`,kind:"remove",issuedAt:Date.now()});V.success?(p(null),setTimeout(()=>{N(),window.location.reload()},500)):p(`Failed to remove items: ${V.error||"Unknown error"}`)}catch(m){p(m instanceof Error?m.message:"An error occurred")}finally{D(!1)}}},H=u.useCallback(n=>{f(`/t/${a}/${o}/${n.id}/${y}`)},[f,a,o,y]),Y=u.useCallback(n=>{n.id==="trash"||n.id===r.trashRootId?f(`/t/${a}/${o}/trash/${y}`):f(`/t/${a}/${o}/${n.id}/${y}`)},[f,a,o,y,r.trashRootId]),q=u.useCallback(()=>{t!=="trash"&&t!==r.trashRootId&&f(`/t/${a}/${o}/trash/${y}`)},[f,a,o,t,r.trashRootId,y]),B=u.useCallback((n,C)=>{v(C?m=>[...m,n]:m=>m.filter(k=>k!==n))},[]),A=u.useCallback((n,C)=>{T(C?m=>[...m,n]:m=>m.filter(k=>k!==n))},[]),x=((O=r.trashItems)==null?void 0:O.map(be))||[],z=Ce(),L=u.useMemo(()=>{const n=[{id:"trash",name:"Trash",nodeType:"folder",isClickable:!0}];return t!=="trash"&&t!==r.trashRootId&&r.targetTreeNode&&n.push({id:r.targetTreeNode.treeNodeId,name:r.targetTreeNode.name,nodeType:r.targetTreeNode.treeNodeType,isClickable:!1}),n},[t,r.trashRootId,r.targetTreeNode]),M=()=>{const n=R?"Restore from Trash":P?"Empty Trash":"Trash";return t!=="trash"&&t!==r.trashRootId&&r.targetTreeNode?`${n} - ${r.targetTreeNode.name}`:n},h=()=>{var n;if(R){const C=b?`Restoring ${i.length} items...`:`Restore Selected (${i.length})`;return s.jsx(U,{variant:"contained",color:"primary",startIcon:s.jsx(we,{}),onClick:K,disabled:i.length===0||b,sx:{minWidth:180},children:C})}else if(P){const C=((n=r.trashItems)==null?void 0:n.length)||0,m=b?`Removing ${C} items...`:`Remove All (${C} items)`;return s.jsx(U,{variant:"contained",color:"error",startIcon:s.jsx(Fe,{}),onClick:G,disabled:C===0||b,sx:{minWidth:180},children:m})}return null};return s.jsxs(ye,{open:!0,fullWidth:!0,maxWidth:"lg",onClose:N,PaperProps:{sx:{height:"80vh",display:"flex",flexDirection:"column"}},children:[s.jsxs($e,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsxs(ae,{sx:{flexGrow:1},children:[s.jsxs(ae,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(_,{variant:"h6",children:M()}),x.length>0&&s.jsx(Ae,{label:`${x.length} items`,size:"small",variant:"outlined",color:P?"error":"primary"})]}),t!=="trash"&&t!==r.trashRootId&&r.targetTreeNode&&s.jsxs(_,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["📁 ",r.targetTreeNode.name]}),(t==="trash"||t===r.trashRootId)&&x.length===0&&s.jsx(_,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"🗑️ Trash is empty"})]}),s.jsx(ke,{onClick:N,size:"small",disabled:b,children:s.jsx(xe,{})})]}),b&&s.jsx(Se,{}),s.jsxs(Ie,{sx:{flex:1,overflow:"hidden",p:0},children:[I&&s.jsx(X,{severity:"error",onClose:()=>p(null),sx:{m:2},action:s.jsx(U,{size:"small",color:"inherit",onClick:()=>p(null),children:"Dismiss"}),children:I}),!b&&!I&&x.length===0&&s.jsx(X,{severity:"info",sx:{m:2},children:t==="trash"||t===r.trashRootId?"🗑️ The trash is empty. Deleted items will appear here.":"📁 This folder is empty."}),P&&s.jsx(X,{severity:"warning",sx:{m:2},children:"⚠️ You are about to remove all items from the trash. This action cannot be undone."}),s.jsx(me,{title:"Trash Items",rootNodeId:r.trashRootId||"trash",data:x,columns:z,breadcrumbItems:L,loading:b,error:I||void 0,selectedIds:R?i:[],expandedIds:$,searchTerm:F,viewMode:"list",canCreate:!1,canEdit:!1,canDelete:!1,showNavigationButtons:!1,dense:!0,availableFilters:[],onNodeClick:H,onNodeSelect:R&&!b?B:void 0,onNodeExpand:A,onSearchChange:j,onSearchClear:()=>j(""),onCreate:()=>{},onEdit:()=>{},onDelete:()=>{},onRefresh:()=>window.location.reload(),onExpandAll:()=>T(x.map(n=>n.id)),onCollapseAll:()=>T([]),onSort:()=>{},onFilterChange:()=>{},onViewModeChange:()=>{},onBreadcrumbNavigate:Y,onNavigateBack:q,onNavigateForward:()=>{},canGoBack:t!=="trash"&&t!==r.trashRootId,canGoForward:!1,onContextMenuAction:()=>{}})]}),s.jsxs(Ee,{sx:{px:3,py:2,gap:1},children:[s.jsx(U,{onClick:N,color:"inherit",disabled:b,children:"Cancel"}),h(),R&&i.length>0&&!b&&s.jsxs(_,{variant:"caption",color:"text.secondary",sx:{ml:2},children:[i.length," item",i.length!==1?"s":""," selected"]})]})]})});export{ro as clientLoader,lo as default};
